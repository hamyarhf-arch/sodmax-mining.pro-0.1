<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù…Ù„ SODmAX</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0066FF;
            --primary-dark: #0052CC;
            --secondary: #00D4AA;
            --accent: #FF6B35;
            --dark: #0A0F1C;
            --card: #121828;
            --text: #FFFFFF;
            --text-secondary: #94A3B8;
            --success: #00C853;
            --warning: #FFB300;
            --error: #FF3D00;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--dark);
            color: var(--text);
            min-height: 100vh;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± */
        .sidebar {
            width: 250px;
            background: var(--card);
            border-left: 1px solid rgba(255,255,255,0.1);
            padding: 20px 0;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }
        
        .logo {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .logo h1 {
            font-size: 20px;
            color: var(--primary);
        }
        
        .logo p {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-menu li {
            margin-bottom: 5px;
        }
        
        .nav-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s;
            border-right: 3px solid transparent;
        }
        
        .nav-menu a:hover,
        .nav-menu a.active {
            background: rgba(0,102,255,0.1);
            color: var(--primary);
            border-right-color: var(--primary);
        }
        
        .nav-menu i {
            width: 20px;
            margin-left: 10px;
        }
        
        /* Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
        }
        
        .header {
            background: var(--card);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, #0D1428, #121828);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-card h3 {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }
        
        /* Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø­ØªÙˆØ§ */
        .content-section {
            background: var(--card);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--error);
            color: white;
        }
        
        /* Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§ */
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        th {
            background: rgba(0,102,255,0.1);
            color: var(--primary-light);
            font-weight: 600;
        }
        
        tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        /* ÙØ±Ù…â€ŒÙ‡Ø§ */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* ØªØ¨â€ŒÙ‡Ø§ */
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .setting-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .setting-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary-light);
        }
        
        .setting-description {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        /* Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--card);
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± -->
        <div class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-user-shield"></i> Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h1>
                <p>SODmAX Pro v1.0</p>
            </div>
            
            <ul class="nav-menu">
                <li><a href="#" class="active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                </a></li>
                <li><a href="#" onclick="showSection('game-settings')">
                    <i class="fas fa-cogs"></i>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ
                </a></li>
                <li><a href="#" onclick="showSection('sale-plans')">
                    <i class="fas fa-shopping-cart"></i>Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´
                </a></li>
                <li><a href="#" onclick="showSection('missions')">
                    <i class="fas fa-tasks"></i>Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§
                </a></li>
                <li><a href="#" onclick="showSection('users')">
                    <i class="fas fa-users"></i>Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                </a></li>
                <li><a href="#" onclick="showSection('transactions')">
                    <i class="fas fa-exchange-alt"></i>ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
                </a></li>
                <li><a href="#" onclick="showSection('reports')">
                    <i class="fas fa-chart-bar"></i>Ú¯Ø²Ø§Ø±Ø´Ø§Øª
                </a></li>
                <li><a href="index.html" style="color: var(--accent);">
                    <i class="fas fa-gamepad"></i>Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ
                </a></li>
            </ul>
        </div>
        
        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
        <div class="main-content" id="mainContent">
            <!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
            <div class="content-section active" id="dashboard-section">
                <div class="header">
                    <h1><i class="fas fa-tachometer-alt"></i> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª</h1>
                    <div id="lastUpdate">Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª: Ù‡Ù…â€ŒØ§Ú©Ù†ÙˆÙ†</div>
                </div>
                
                <div class="stats-grid" id="dashboardStats">
                    <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
                
                <div class="content-section">
                    <h2>ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h2>
                    <div id="recentActivity">
                        <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                </div>
            </div>
            
            <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ -->
            <div class="content-section" id="game-settings-section">
                <div class="section-header">
                    <h2><i class="fas fa-cogs"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§Ø²ÛŒ</h2>
                    <button class="btn btn-success" onclick="saveAllSettings()">
                        <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ Ù‡Ù…Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                    </button>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="showSettingsTab('mining')">âš™ï¸ Ø§Ø³ØªØ®Ø±Ø§Ø¬</div>
                    <div class="tab" onclick="showSettingsTab('progress')">ğŸ“ˆ Ù¾ÛŒØ´Ø±ÙØª</div>
                    <div class="tab" onclick="showSettingsTab('economy')">ğŸ’° Ø§Ù‚ØªØµØ§Ø¯</div>
                    <div class="tab" onclick="showSettingsTab('other')">âš¡ Ø³Ø§ÛŒØ±</div>
                </div>
                
                <!-- ØªØ¨ Ø§Ø³ØªØ®Ø±Ø§Ø¬ -->
                <div class="tab-content active" id="mining-settings">
                    <div class="settings-grid" id="miningSettings">
                        <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                </div>
                
                <!-- ØªØ¨ Ù¾ÛŒØ´Ø±ÙØª -->
                <div class="tab-content" id="progress-settings">
                    <div class="settings-grid" id="progressSettings">
                        <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                </div>
                
                <!-- ØªØ¨ Ø§Ù‚ØªØµØ§Ø¯ -->
                <div class="tab-content" id="economy-settings">
                    <div class="settings-grid" id="economySettings">
                        <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                </div>
                
                <!-- ØªØ¨ Ø³Ø§ÛŒØ± -->
                <div class="tab-content" id="other-settings">
                    <div class="settings-grid" id="otherSettings">
                        <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                </div>
            </div>
            
            <!-- Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´ -->
            <div class="content-section" id="sale-plans-section">
                <div class="section-header">
                    <h2><i class="fas fa-shopping-cart"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´</h2>
                    <button class="btn btn-primary" onclick="showEditPlanModal(null)">
                        <i class="fas fa-plus"></i> Ù¾Ù†Ù„ Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ù†Ø§Ù… Ù¾Ù†Ù„</th>
                                <th>Ù‚ÛŒÙ…Øª (USDT)</th>
                                <th>SOD Ø§ØµÙ„ÛŒ</th>
                                <th>ØªØ®ÙÛŒÙ</th>
                                <th>SOD Ú©Ù„</th>
                                <th>ÙˆÛŒÚ˜Ù‡</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="salePlansTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ -->
            <div class="content-section" id="missions-section">
                <div class="section-header">
                    <h2><i class="fas fa-tasks"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ (Û¶ Ù…Ø£Ù…ÙˆØ±ÛŒØª)</h2>
                    <button class="btn btn-primary" onclick="showEditMissionModal(null)">
                        <i class="fas fa-plus"></i> Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>Ù‡Ø¯Ù</th>
                                <th>Ù¾Ø§Ø¯Ø§Ø´ SOD</th>
                                <th>Ù¾Ø§Ø¯Ø§Ø´ USDT</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="missionsTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
            <div class="content-section" id="users-section">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>
                    <div>
                        <input type="text" id="searchUsers" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±..." class="form-input" style="width: 200px;">
                        <button class="btn btn-primary" onclick="searchUsers()">
                            <i class="fas fa-search"></i> Ø¬Ø³ØªØ¬Ùˆ
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø§ÛŒÙ…ÛŒÙ„</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>Ø³Ø·Ø­</th>
                                <th>SOD</th>
                                <th>USDT</th>
                                <th>Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-outline" onclick="loadMoreUsers()">
                        <i class="fas fa-arrow-down"></i> Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ±
                    </button>
                </div>
            </div>
            
            <!-- ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ -->
            <div class="content-section" id="transactions-section">
                <div class="section-header">
                    <h2><i class="fas fa-exchange-alt"></i> ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h2>
                    <div>
                        <select id="transactionFilter" class="form-input" style="width: 150px;">
                            <option value="all">Ù‡Ù…Ù‡</option>
                            <option value="mining">Ø§Ø³ØªØ®Ø±Ø§Ø¬</option>
                            <option value="purchase">Ø®Ø±ÛŒØ¯</option>
                            <option value="usdt_reward">Ù¾Ø§Ø¯Ø§Ø´ USDT</option>
                        </select>
                        <button class="btn btn-primary" onclick="filterTransactions()">
                            <i class="fas fa-filter"></i> ÙÛŒÙ„ØªØ±
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ú©Ø§Ø±Ø¨Ø±</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>Ù…Ù‚Ø¯Ø§Ø±</th>
                                <th>ÙˆØ§Ø­Ø¯</th>
                                <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Ú¯Ø²Ø§Ø±Ø´Ø§Øª -->
            <div class="content-section" id="reports-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ùˆ Ø¢Ù…Ø§Ø±</h2>
                    <div>
                        <select id="reportPeriod" class="form-input" style="width: 150px;">
                            <option value="today">Ø§Ù…Ø±ÙˆØ²</option>
                            <option value="week">Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ</option>
                            <option value="month">Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ</option>
                            <option value="all">Ù‡Ù…Ù‡ Ø²Ù…Ø§Ù†</option>
                        </select>
                        <button class="btn btn-primary" onclick="generateReport()">
                            <i class="fas fa-chart-line"></i> Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²Ø§Ø±Ø´
                        </button>
                    </div>
                </div>
                
                <div id="reportContent">
                    <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ù†Ù„ -->
    <div class="modal" id="editPlanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ù†Ù„ ÙØ±ÙˆØ´</h3>
                <button class="modal-close" onclick="closeModal('editPlanModal')">Ã—</button>
            </div>
            <form id="planForm">
                <input type="hidden" id="planId">
                <div class="form-group">
                    <label class="form-label">Ù†Ø§Ù… Ù¾Ù†Ù„</label>
                    <input type="text" id="planName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù‚ÛŒÙ…Øª (USDT)</label>
                    <input type="number" id="planPrice" class="form-input" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù…Ù‚Ø¯Ø§Ø± SOD Ø§ØµÙ„ÛŒ</label>
                    <input type="number" id="planSodAmount" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø¯Ø±ØµØ¯ ØªØ®ÙÛŒÙ</label>
                    <input type="number" id="planDiscount" class="form-input" min="0" max="100" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">ÙˆÛŒÚ˜Ù‡ (Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯)</label>
                    <input type="checkbox" id="planPopular">
                </div>
                <div class="form-group">
                    <label class="form-label">ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ (Ù‡Ø± Ø®Ø· ÛŒÚ© ÙˆÛŒÚ˜Ú¯ÛŒ)</label>
                    <textarea id="planFeatures" class="form-input" rows="4"></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deletePlan()" id="deletePlanBtn" style="display: none;">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø£Ù…ÙˆØ±ÛŒØª -->
    <div class="modal" id="editMissionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø£Ù…ÙˆØ±ÛŒØª</h3>
                <button class="modal-close" onclick="closeModal('editMissionModal')">Ã—</button>
            </div>
            <form id="missionForm">
                <input type="hidden" id="missionId">
                <div class="form-group">
                    <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ù…Ø£Ù…ÙˆØ±ÛŒØª</label>
                    <input type="text" id="missionTitle" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                    <textarea id="missionDescription" class="form-input" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù†ÙˆØ¹ Ù…Ø£Ù…ÙˆØ±ÛŒØª</label>
                    <select id="missionType" class="form-input">
                        <option value="daily">Ø±ÙˆØ²Ø§Ù†Ù‡</option>
                        <option value="weekly">Ù‡ÙØªÚ¯ÛŒ</option>
                        <option value="special">ÙˆÛŒÚ˜Ù‡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù†ÙˆØ¹ Ù‡Ø¯Ù</label>
                    <select id="missionTargetType" class="form-input">
                        <option value="manual_mining">ØªØ¹Ø¯Ø§Ø¯ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¯Ø³ØªÛŒ</option>
                        <option value="auto_mining">Ù…Ø¯Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø®ÙˆØ¯Ú©Ø§Ø± (Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡)</option>
                        <option value="use_boost">Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¨ÙˆØ³Øª</option>
                        <option value="buy_plans">Ø®Ø±ÛŒØ¯ Ù¾Ù†Ù„</option>
                        <option value="total_mining">SOD Ú©Ù„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡</option>
                        <option value="reach_level">Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Ø³Ø·Ø­</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù…Ù‚Ø¯Ø§Ø± Ù‡Ø¯Ù</label>
                    <input type="number" id="missionTarget" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù¾Ø§Ø¯Ø§Ø´ SOD</label>
                    <input type="number" id="missionRewardSod" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù¾Ø§Ø¯Ø§Ø´ USDT</label>
                    <input type="number" id="missionRewardUsdt" class="form-input" step="0.0001" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù¾Ø§Ø¯Ø§Ø´ ØªØ¬Ø±Ø¨Ù‡ (XP)</label>
                    <input type="number" id="missionRewardExp" class="form-input" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">ÙØ¹Ø§Ù„</label>
                    <input type="checkbox" id="missionActive" checked>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deleteMission()" id="deleteMissionBtn" style="display: none;">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± -->
    <div class="modal" id="editUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±</h3>
                <button class="modal-close" onclick="closeModal('editUserModal')">Ã—</button>
            </div>
            <form id="userForm">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label class="form-label">Ø§ÛŒÙ…ÛŒÙ„</label>
                    <input type="email" id="userEmail" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù†Ø§Ù… Ú©Ø§Ù…Ù„</label>
                    <input type="text" id="userFullName" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø³Ø·Ø­</label>
                    <input type="number" id="userLevel" class="form-input" min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ SOD</label>
                    <input type="number" id="userSod" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ USDT</label>
                    <input type="number" id="userUsdt" class="form-input" step="0.000001">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù‚Ø¯Ø±Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬</label>
                    <input type="number" id="userMiningPower" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">ÙˆØ¶Ø¹ÛŒØª Ø­Ø³Ø§Ø¨</label>
                    <select id="userStatus" class="form-input">
                        <option value="active">ÙØ¹Ø§Ù„</option>
                        <option value="suspended">ØªØ¹Ù„ÛŒÙ‚</option>
                        <option value="banned">Ù…Ø³Ø¯ÙˆØ¯</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                    </button>
                    <button type="button" class="btn btn-danger" onclick="resetUserPassword()">
                        <i class="fas fa-key"></i> Ø±ÛŒØ³Øª Ø±Ù…Ø²
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="js/supabase.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ú¯Ù„ÙˆØ¨Ø§Ù„
        let currentUserPage = 1;
        const usersPerPage = 20;
        let gameSettings = {};
        let salePlans = [];
        let missions = [];
        
        // ÙˆÙ‚ØªÛŒ DOM Ù„ÙˆØ¯ Ø´Ø¯
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Admin panel loaded');
            
            // Ú†Ú© Ú©Ø±Ø¯Ù† Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
            if (!window.authService || !window.authService.isUserVerified()) {
                alert('âš ï¸ Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø². Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.');
                window.location.href = 'index.html';
                return;
            }
            
            // Ú†Ú© Ú©Ø±Ø¯Ù† Ø§Ø¯Ù…ÛŒÙ† Ø¨ÙˆØ¯Ù†
            const user = window.authService.getCurrentUser();
            if (!user || user.email !== 'hamyarhf@gmail.com') {
                alert('âš ï¸ Ø§ÛŒÙ† ØµÙØ­Ù‡ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø³Øª.');
                window.location.href = 'index.html';
                return;
            }
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
            await loadDashboardData();
            await loadGameSettings();
            await loadSalePlans();
            await loadMissions();
            
            // Ø§ÛŒÙˆÙ†Øªâ€ŒÙ‡Ø§
            document.getElementById('planForm').addEventListener('submit', savePlan);
            document.getElementById('missionForm').addEventListener('submit', saveMission);
            document.getElementById('userForm').addEventListener('submit', saveUser);
            
            // Ø±ÛŒÙØ±Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± 30 Ø«Ø§Ù†ÛŒÙ‡
            setInterval(updateDashboard, 30000);
        });
        
        // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´â€ŒÙ‡Ø§
        function showSection(sectionId) {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Ø¢Ù¾Ø¯ÛŒØª Ù…Ù†Ùˆ
            document.querySelectorAll('.nav-menu a').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±
            const section = document.getElementById(sectionId + '-section');
            if (section) {
                section.classList.add('active');
                
                // Ø§Ú¯Ø± Ø¨Ø®Ø´ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ø³ØªØŒ Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†
                if (sectionId === 'dashboard') {
                    updateDashboard();
                }
            }
        }
        
        // ==================== DASHBOARD ====================
        async function loadDashboardData() {
            try {
                const statsGrid = document.getElementById('dashboardStats');
                if (!statsGrid) return;
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø±
                const userCount = await window.supabaseService.getUserCount();
                const { data: transactions } = await window.supabaseClient
                    .from('transactions')
                    .select('count')
                    .single();
                
                const { data: totalSod } = await window.supabaseClient
                    .from('users')
                    .select('sod_balance')
                    .then(res => ({
                        total: res.data.reduce((sum, user) => sum + (user.sod_balance || 0), 0)
                    }));
                
                const { data: recentUsers } = await window.supabaseClient
                    .from('users')
                    .select('*')
                    .order('last_login', { ascending: false })
                    .limit(5);
                
                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <h3>ğŸ‘¥ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ú©Ù„</h3>
                        <div class="value">${userCount}</div>
                    </div>
                    <div class="stat-card">
                        <h3>ğŸ’³ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h3>
                        <div class="value">${transactions?.count || 0}</div>
                    </div>
                    <div class="stat-card">
                        <h3>ğŸ’° SOD Ú©Ù„ Ø´Ø¨Ú©Ù‡</h3>
                        <div class="value">${formatNumber(totalSod?.total || 0)}</div>
                    </div>
                    <div class="stat-card">
                        <h3>ğŸ“Š Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§</h3>
                        <div class="value">6/6</div>
                    </div>
                `;
                
                // Ù†Ù…Ø§ÛŒØ´ Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
                const recentActivity = document.getElementById('recentActivity');
                if (recentActivity && recentUsers) {
                    recentActivity.innerHTML = recentUsers.map(user => `
                        <div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <div>
                                <strong>${user.full_name || user.email}</strong>
                                <div style="font-size: 12px; color: var(--text-secondary);">
                                    Ø³Ø·Ø­ ${user.level || 1} â€¢ ${formatNumber(user.sod_balance || 0)} SOD
                                </div>
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                ${new Date(user.last_login).toLocaleString('fa-IR')}
                            </div>
                        </div>
                    `).join('');
                }
                
                // Ø¢Ù¾Ø¯ÛŒØª ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                document.getElementById('lastUpdate').textContent = 
                    `Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª: ${new Date().toLocaleTimeString('fa-IR')}`;
                    
            } catch (error) {
                console.error('âŒ Error loading dashboard:', error);
            }
        }
        
        function updateDashboard() {
            loadDashboardData();
        }
        
        // ==================== GAME SETTINGS ====================
        async function loadGameSettings() {
            try {
                gameSettings = await window.supabaseService.getGameSettings();
                renderGameSettings();
            } catch (error) {
                console.error('âŒ Error loading game settings:', error);
            }
        }
        
        function renderGameSettings() {
            // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            const miningSettings = {};
            const progressSettings = {};
            const economySettings = {};
            const otherSettings = {};
            
            Object.keys(gameSettings).forEach(key => {
                if (key.includes('mining') || key.includes('boost') || key.includes('auto')) {
                    miningSettings[key] = gameSettings[key];
                } else if (key.includes('level') || key.includes('mission') || key.includes('progress')) {
                    progressSettings[key] = gameSettings[key];
                } else if (key.includes('sale') || key.includes('price') || key.includes('usdt')) {
                    economySettings[key] = gameSettings[key];
                } else {
                    otherSettings[key] = gameSettings[key];
                }
            });
            
            // Ø±Ù†Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬
            const miningContainer = document.getElementById('miningSettings');
            if (miningContainer) {
                miningContainer.innerHTML = Object.keys(miningSettings).map(key => `
                    <div class="setting-card">
                        <div class="setting-title">${key.replace(/_/g, ' ')}</div>
                        <div class="setting-description">${miningSettings[key].description || ''}</div>
                        <input type="text" 
                               class="form-input" 
                               value="${miningSettings[key].value}"
                               data-key="${key}"
                               onchange="updateSettingValue('${key}', this.value)">
                    </div>
                `).join('');
            }
            
            // Ø±Ù†Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØª
            const progressContainer = document.getElementById('progressSettings');
            if (progressContainer) {
                progressContainer.innerHTML = Object.keys(progressSettings).map(key => `
                    <div class="setting-card">
                        <div class="setting-title">${key.replace(/_/g, ' ')}</div>
                        <div class="setting-description">${progressSettings[key].description || ''}</div>
                        <input type="text" 
                               class="form-input" 
                               value="${progressSettings[key].value}"
                               data-key="${key}"
                               onchange="updateSettingValue('${key}', this.value)">
                    </div>
                `).join('');
            }
            
            // Ø±Ù†Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ù‚ØªØµØ§Ø¯
            const economyContainer = document.getElementById('economySettings');
            if (economyContainer) {
                economyContainer.innerHTML = Object.keys(economySettings).map(key => `
                    <div class="setting-card">
                        <div class="setting-title">${key.replace(/_/g, ' ')}</div>
                        <div class="setting-description">${economySettings[key].description || ''}</div>
                        <input type="text" 
                               class="form-input" 
                               value="${economySettings[key].value}"
                               data-key="${key}"
                               onchange="updateSettingValue('${key}', this.value)">
                    </div>
                `).join('');
            }
            
            // Ø±Ù†Ø¯Ø± Ø³Ø§ÛŒØ± ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            const otherContainer = document.getElementById('otherSettings');
            if (otherContainer) {
                otherContainer.innerHTML = Object.keys(otherSettings).map(key => `
                    <div class="setting-card">
                        <div class="setting-title">${key.replace(/_/g, ' ')}</div>
                        <div class="setting-description">${otherSettings[key].description || ''}</div>
                        <input type="text" 
                               class="form-input" 
                               value="${otherSettings[key].value}"
                               data-key="${key}"
                               onchange="updateSettingValue('${key}', this.value)">
                    </div>
                `).join('');
            }
        }
        
        function showSettingsTab(tabName) {
            // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØªØ¨â€ŒÙ‡Ø§
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªØ¨ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            event.target.classList.add('active');
            document.getElementById(tabName + '-settings').classList.add('active');
        }
        
        function updateSettingValue(key, value) {
            gameSettings[key].value = value;
        }
        
        async function saveAllSettings() {
            try {
                const updates = [];
                
                for (const [key, setting] of Object.entries(gameSettings)) {
                    updates.push(
                        window.supabaseService.updateGameSetting(key, setting.value)
                    );
                }
                
                await Promise.all(updates);
                alert('âœ… ØªÙ…Ø§Ù… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯.');
            } catch (error) {
                console.error('âŒ Error saving settings:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª');
            }
        }
        
        // ==================== SALE PLANS ====================
        async function loadSalePlans() {
            try {
                salePlans = await window.supabaseService.getSalePlans();
                renderSalePlans();
            } catch (error) {
                console.error('âŒ Error loading sale plans:', error);
            }
        }
        
        function renderSalePlans() {
            const table = document.getElementById('salePlansTable');
            if (!table) return;
            
            table.innerHTML = salePlans.map((plan, index) => {
                const totalSod = plan.sod_amount + Math.floor(plan.sod_amount * (plan.discount / 100));
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${plan.name}</td>
                        <td>${plan.price} USDT</td>
                        <td>${formatNumber(plan.sod_amount)}</td>
                        <td>${plan.discount}%</td>
                        <td>${formatNumber(totalSod)}</td>
                        <td>${plan.popular ? 'â­' : 'â€”'}</td>
                        <td>
                            <button class="btn btn-primary" onclick="showEditPlanModal(${plan.id})" style="padding: 5px 10px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger" onclick="deletePlan(${plan.id})" style="padding: 5px 10px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function showEditPlanModal(planId) {
            const modal = document.getElementById('editPlanModal');
            const form = document.getElementById('planForm');
            const deleteBtn = document.getElementById('deletePlanBtn');
            
            if (planId) {
                // Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´
                const plan = salePlans.find(p => p.id === planId);
                if (plan) {
                    document.getElementById('planId').value = plan.id;
                    document.getElementById('planName').value = plan.name;
                    document.getElementById('planPrice').value = plan.price;
                    document.getElementById('planSodAmount').value = plan.sod_amount;
                    document.getElementById('planDiscount').value = plan.discount || 0;
                    document.getElementById('planPopular').checked = plan.popular || false;
                    document.getElementById('planFeatures').value = Array.isArray(plan.features) ? 
                        plan.features.join('\n') : '';
                    
                    deleteBtn.style.display = 'inline-block';
                    deleteBtn.setAttribute('data-plan-id', plan.id);
                }
            } else {
                // Ø­Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯
                form.reset();
                document.getElementById('planId').value = '';
                deleteBtn.style.display = 'none';
            }
            
            modal.classList.add('active');
        }
        
        async function savePlan(e) {
            e.preventDefault();
            
            const planId = document.getElementById('planId').value;
            const planData = {
                name: document.getElementById('planName').value,
                price: parseFloat(document.getElementById('planPrice').value),
                sod_amount: parseInt(document.getElementById('planSodAmount').value),
                discount: parseInt(document.getElementById('planDiscount').value) || 0,
                popular: document.getElementById('planPopular').checked,
                features: document.getElementById('planFeatures').value.split('\n').filter(f => f.trim())
            };
            
            try {
                if (planId) {
                    // Ø¢Ù¾Ø¯ÛŒØª Ù¾Ù†Ù„ Ù…ÙˆØ¬ÙˆØ¯
                    await window.supabaseClient
                        .from('sale_plans')
                        .update(planData)
                        .eq('id', planId);
                } else {
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ù†Ù„ Ø¬Ø¯ÛŒØ¯
                    await window.supabaseClient
                        .from('sale_plans')
                        .insert([planData]);
                }
                
                closeModal('editPlanModal');
                await loadSalePlans();
                alert('âœ… Ù¾Ù†Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
            } catch (error) {
                console.error('âŒ Error saving plan:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾Ù†Ù„');
            }
        }
        
        async function deletePlan(planId) {
            if (!confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù¾Ù†Ù„ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
                return;
            }
            
            try {
                await window.supabaseClient
                    .from('sale_plans')
                    .delete()
                    .eq('id', planId);
                
                await loadSalePlans();
                alert('âœ… Ù¾Ù†Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.');
            } catch (error) {
                console.error('âŒ Error deleting plan:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾Ù†Ù„');
            }
        }
        
        // ==================== MISSIONS ====================
        async function loadMissions() {
            try {
                missions = await window.supabaseService.getMissions();
                renderMissions();
            } catch (error) {
                console.error('âŒ Error loading missions:', error);
            }
        }
        
        function renderMissions() {
            const table = document.getElementById('missionsTable');
            if (!table) return;
            
            table.innerHTML = missions.map((mission, index) => {
                const requirements = JSON.parse(mission.requirements || '{}');
                const rewards = JSON.parse(mission.rewards || '{}');
                
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${mission.title}</td>
                        <td>${mission.mission_type === 'daily' ? 'Ø±ÙˆØ²Ø§Ù†Ù‡' : 
                               mission.mission_type === 'weekly' ? 'Ù‡ÙØªÚ¯ÛŒ' : 'ÙˆÛŒÚ˜Ù‡'}</td>
                        <td>${requirements.target || 0} ${getMissionTargetUnit(requirements.type)}</td>
                        <td>${formatNumber(rewards.sod || 0)}</td>
                        <td>${rewards.usdt || 0}</td>
                        <td>${mission.is_active ? 'âœ… ÙØ¹Ø§Ù„' : 'âŒ ØºÛŒØ±ÙØ¹Ø§Ù„'}</td>
                        <td>
                            <button class="btn btn-primary" onclick="showEditMissionModal(${mission.id})" style="padding: 5px 10px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger" onclick="deleteMission(${mission.id})" style="padding: 5px 10px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function getMissionTargetUnit(type) {
            const units = {
                'manual_mining': 'Ø¨Ø§Ø±',
                'auto_mining': 'Ø¯Ù‚ÛŒÙ‚Ù‡',
                'use_boost': 'Ø¨Ø§Ø±',
                'buy_plans': 'Ø¹Ø¯Ø¯',
                'total_mining': 'SOD',
                'reach_level': 'Ø³Ø·Ø­'
            };
            return units[type] || '';
        }
        
        function showEditMissionModal(missionId) {
            const modal = document.getElementById('editMissionModal');
            const form = document.getElementById('missionForm');
            const deleteBtn = document.getElementById('deleteMissionBtn');
            
            if (missionId) {
                // Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´
                const mission = missions.find(m => m.id === missionId);
                if (mission) {
                    const requirements = JSON.parse(mission.requirements || '{}');
                    const rewards = JSON.parse(mission.rewards || '{}');
                    
                    document.getElementById('missionId').value = mission.id;
                    document.getElementById('missionTitle').value = mission.title;
                    document.getElementById('missionDescription').value = mission.description || '';
                    document.getElementById('missionType').value = mission.mission_type;
                    document.getElementById('missionTargetType').value = requirements.type || 'manual_mining';
                    document.getElementById('missionTarget').value = requirements.target || 0;
                    document.getElementById('missionRewardSod').value = rewards.sod || 0;
                    document.getElementById('missionRewardUsdt').value = rewards.usdt || 0;
                    document.getElementById('missionRewardExp').value = rewards.exp || 0;
                    document.getElementById('missionActive').checked = mission.is_active;
                    
                    deleteBtn.style.display = 'inline-block';
                    deleteBtn.setAttribute('data-mission-id', mission.id);
                }
            } else {
                // Ø­Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯
                form.reset();
                document.getElementById('missionId').value = '';
                deleteBtn.style.display = 'none';
            }
            
            modal.classList.add('active');
        }
        
        async function saveMission(e) {
            e.preventDefault();
            
            const missionId = document.getElementById('missionId').value;
            const missionData = {
                title: document.getElementById('missionTitle').value,
                description: document.getElementById('missionDescription').value,
                mission_type: document.getElementById('missionType').value,
                requirements: JSON.stringify({
                    type: document.getElementById('missionTargetType').value,
                    target: parseInt(document.getElementById('missionTarget').value),
                    current: 0
                }),
                rewards: JSON.stringify({
                    sod: parseInt(document.getElementById('missionRewardSod').value),
                    usdt: parseFloat(document.getElementById('missionRewardUsdt').value),
                    exp: parseInt(document.getElementById('missionRewardExp').value)
                }),
                is_active: document.getElementById('missionActive').checked,
                order_index: missions.length + 1
            };
            
            try {
                if (missionId) {
                    // Ø¢Ù¾Ø¯ÛŒØª Ù…Ø£Ù…ÙˆØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯
                    await window.supabaseClient
                        .from('missions')
                        .update(missionData)
                        .eq('id', missionId);
                } else {
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø¬Ø¯ÛŒØ¯
                    await window.supabaseClient
                        .from('missions')
                        .insert([missionData]);
                }
                
                closeModal('editMissionModal');
                await loadMissions();
                alert('âœ… Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
            } catch (error) {
                console.error('âŒ Error saving mission:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…Ø£Ù…ÙˆØ±ÛŒØª');
            }
        }
        
        async function deleteMission(missionId) {
            if (!confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
                return;
            }
            
            try {
                await window.supabaseClient
                    .from('missions')
                    .delete()
                    .eq('id', missionId);
                
                await loadMissions();
                alert('âœ… Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.');
            } catch (error) {
                console.error('âŒ Error deleting mission:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù…Ø£Ù…ÙˆØ±ÛŒØª');
            }
        }
        
        // ==================== USERS ====================
        async function loadUsers(page = 1) {
            try {
                const offset = (page - 1) * usersPerPage;
                const users = await window.supabaseService.getAllUsers(usersPerPage, offset);
                renderUsers(users);
                currentUserPage = page;
            } catch (error) {
                console.error('âŒ Error loading users:', error);
            }
        }
        
        function renderUsers(users) {
            const table = document.getElementById('usersTable');
            if (!table) return;
            
            table.innerHTML = users.map((user, index) => {
                const rowNum = (currentUserPage - 1) * usersPerPage + index + 1;
                return `
                    <tr>
                        <td>${rowNum}</td>
                        <td>${user.email}</td>
                        <td>${user.full_name || 'â€”'}</td>
                        <td>${user.level || 1}</td>
                        <td>${formatNumber(user.sod_balance || 0)}</td>
                        <td>${(user.usdt_balance || 0).toFixed(4)}</td>
                        <td>${new Date(user.last_login).toLocaleDateString('fa-IR')}</td>
                        <td>
                            <span style="color: var(--success);">âœ… ÙØ¹Ø§Ù„</span>
                        </td>
                        <td>
                            <button class="btn btn-primary" onclick="showEditUserModal('${user.id}')" style="padding: 5px 10px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-warning" onclick="suspendUser('${user.id}')" style="padding: 5px 10px;">
                                <i class="fas fa-pause"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function loadMoreUsers() {
            loadUsers(currentUserPage + 1);
        }
        
        async function searchUsers() {
            const searchTerm = document.getElementById('searchUsers').value.toLowerCase();
            if (!searchTerm) {
                await loadUsers(1);
                return;
            }
            
            try {
                const { data: users, error } = await window.supabaseClient
                    .from('users')
                    .select('*')
                    .or(`email.ilike.%${searchTerm}%,full_name.ilike.%${searchTerm}%`)
                    .limit(50);
                
                if (error) throw error;
                
                renderUsers(users || []);
            } catch (error) {
                console.error('âŒ Error searching users:', error);
            }
        }
        
        async function showEditUserModal(userId) {
            try {
                const { data: user, error } = await window.supabaseClient
                    .from('users')
                    .select('*')
                    .eq('id', userId)
                    .single();
                
                if (error) throw error;
                
                document.getElementById('userId').value = user.id;
                document.getElementById('userEmail').value = user.email;
                document.getElementById('userFullName').value = user.full_name || '';
                document.getElementById('userLevel').value = user.level || 1;
                document.getElementById('userSod').value = user.sod_balance || 0;
                document.getElementById('userUsdt').value = user.usdt_balance || 0;
                document.getElementById('userMiningPower').value = user.mining_power || 10;
                document.getElementById('userStatus').value = 'active';
                
                document.getElementById('editUserModal').classList.add('active');
            } catch (error) {
                console.error('âŒ Error loading user:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±');
            }
        }
        
        async function saveUser(e) {
            e.preventDefault();
            
            const userId = document.getElementById('userId').value;
            const userData = {
                full_name: document.getElementById('userFullName').value,
                level: parseInt(document.getElementById('userLevel').value),
                sod_balance: parseInt(document.getElementById('userSod').value),
                usdt_balance: parseFloat(document.getElementById('userUsdt').value),
                mining_power: parseInt(document.getElementById('userMiningPower').value)
            };
            
            try {
                await window.supabaseClient
                    .from('users')
                    .update(userData)
                    .eq('id', userId);
                
                closeModal('editUserModal');
                await loadUsers(currentUserPage);
                alert('âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
            } catch (error) {
                console.error('âŒ Error saving user:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±');
            }
        }
        
        async function suspendUser(userId) {
            if (!confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ ØªØ¹Ù„ÛŒÙ‚ Ú©Ù†ÛŒØ¯ØŸ')) {
                return;
            }
            
            try {
                await window.supabaseClient
                    .from('users')
                    .update({ status: 'suspended' })
                    .eq('id', userId);
                
                await loadUsers(currentUserPage);
                alert('âœ… Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØ¹Ù„ÛŒÙ‚ Ø´Ø¯.');
            } catch (error) {
                console.error('âŒ Error suspending user:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ¹Ù„ÛŒÙ‚ Ú©Ø§Ø±Ø¨Ø±');
            }
        }
        
        function resetUserPassword() {
            const userId = document.getElementById('userId').value;
            const newPassword = Math.random().toString(36).slice(-8);
            
            alert(`Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±: ${newPassword}\nØ§ÛŒÙ† Ø±Ù…Ø² Ø±Ø§ Ø¯Ø± Ø§Ø®ØªÛŒØ§Ø± Ú©Ø§Ø±Ø¨Ø± Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.`);
        }
        
        // ==================== TRANSACTIONS ====================
        async function loadTransactions() {
            try {
                const { data: transactions, error } = await window.supabaseClient
                    .from('transactions')
                    .select(`
                        *,
                        users (email)
                    `)
                    .order('created_at', { ascending: false })
                    .limit(50);
                
                if (error) throw error;
                
                renderTransactions(transactions || []);
            } catch (error) {
                console.error('âŒ Error loading transactions:', error);
            }
        }
        
        function renderTransactions(transactions) {
            const table = document.getElementById('transactionsTable');
            if (!table) return;
            
            table.innerHTML = transactions.map((t, index) => {
                const userEmail = t.users?.email || 'Ù†Ø§Ø´Ù†Ø§Ø³';
                const amountColor = t.amount >= 0 ? 'var(--success)' : 'var(--error)';
                const amountSign = t.amount >= 0 ? '+' : '';
                
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${userEmail}</td>
                        <td>${getTransactionTypeText(t.type)}</td>
                        <td style="color: ${amountColor}">${amountSign}${Math.abs(t.amount).toLocaleString()}</td>
                        <td>${t.currency}</td>
                        <td>${t.description || 'â€”'}</td>
                        <td>${new Date(t.created_at).toLocaleString('fa-IR')}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function getTransactionTypeText(type) {
            const types = {
                'mining': 'Ø§Ø³ØªØ®Ø±Ø§Ø¬',
                'purchase': 'Ø®Ø±ÛŒØ¯',
                'usdt_reward': 'Ù¾Ø§Ø¯Ø§Ø´ USDT',
                'boost': 'Ø§ÙØ²Ø§ÛŒØ´ Ù‚Ø¯Ø±Øª',
                'withdrawal': 'Ø¨Ø±Ø¯Ø§Ø´Øª'
            };
            return types[type] || type;
        }
        
        function filterTransactions() {
            const filterValue = document.getElementById('transactionFilter').value;
            if (filterValue === 'all') {
                loadTransactions();
            } else {
                // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹
                alert('Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø± Ù†Ø³Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.');
            }
        }
        
        // ==================== REPORTS ====================
        async function generateReport() {
            const period = document.getElementById('reportPeriod').value;
            const reportContent = document.getElementById('reportContent');
            
            reportContent.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="fas fa-chart-line" style="font-size: 48px; margin-bottom: 20px;"></i>
                    <h3>Ú¯Ø²Ø§Ø±Ø´ ${period === 'today' ? 'Ø§Ù…Ø±ÙˆØ²' : 
                                period === 'week' ? 'Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ' : 
                                period === 'month' ? 'Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ' : 'Ù‡Ù…Ù‡ Ø²Ù…Ø§Ù†'}</h3>
                    <p>Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§...</p>
                </div>
            `;
            
            // Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø¨Ø§Ø´Ø¯ Ùˆ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø§Ø±Ø¯
            setTimeout(() => {
                reportContent.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>ğŸ“ˆ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯</h3>
                            <div class="value">12</div>
                        </div>
                        <div class="stat-card">
                            <h3>ğŸ’° Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„ÛŒ</h3>
                            <div class="value">150 USDT</div>
                        </div>
                        <div class="stat-card">
                            <h3>â›ï¸ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù„</h3>
                            <div class="value">45M SOD</div>
                        </div>
                        <div class="stat-card">
                            <h3>ğŸ¯ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§</h3>
                            <div class="value">87% ØªÚ©Ù…ÛŒÙ„</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px;">
                        <h3>ğŸ“Š Ù†Ù…ÙˆØ¯Ø§Ø± ÙØ¹Ø§Ù„ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
                        <p style="text-align: center; padding: 50px; color: var(--text-secondary);">
                            <i class="fas fa-chart-bar"></i> Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ Ø¯Ø± Ù†Ø³Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯
                        </p>
                    </div>
                `;
            }, 1000);
        }
        
        // ==================== UTILITY FUNCTIONS ====================
        function formatNumber(num) {
            num = Number(num);
            if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return Math.floor(num).toLocaleString('fa-IR');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
        loadUsers();
        loadTransactions();
        generateReport();
    </script>
</body>
</html>
