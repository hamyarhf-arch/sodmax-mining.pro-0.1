<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù…Ù„ SODmAX</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0066FF;
            --primary-dark: #0052CC;
            --secondary: #00D4AA;
            --accent: #FF6B35;
            --dark: #0A0F1C;
            --card: #121828;
            --text: #FFFFFF;
            --text-secondary: #94A3B8;
            --success: #00C853;
            --warning: #FFB300;
            --error: #FF3D00;
            --radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--dark);
            color: var(--text);
            min-height: 100vh;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± */
        .sidebar {
            width: 250px;
            background: var(--card);
            border-left: 1px solid rgba(255,255,255,0.1);
            padding: 20px 0;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }
        
        .logo {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .logo h1 {
            font-size: 20px;
            color: var(--primary);
        }
        
        .logo p {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-menu li {
            margin-bottom: 5px;
        }
        
        .nav-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s;
            border-right: 3px solid transparent;
        }
        
        .nav-menu a:hover,
        .nav-menu a.active {
            background: rgba(0,102,255,0.1);
            color: var(--primary);
            border-right-color: var(--primary);
        }
        
        .nav-menu i {
            width: 20px;
            margin-left: 10px;
        }
        
        /* Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
        }
        
        .header {
            background: var(--card);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, #0D1428, #121828);
            padding: 20px;
            border-radius: var(--radius);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-card h3 {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }
        
        /* Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø­ØªÙˆØ§ */
        .content-section {
            background: var(--card);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--error);
            color: white;
        }
        
        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
        }
        
        /* Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§ */
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        th {
            background: rgba(0,102,255,0.1);
            color: var(--primary);
            font-weight: 600;
        }
        
        tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        /* ÙØ±Ù…â€ŒÙ‡Ø§ */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* ØªØ¨â€ŒÙ‡Ø§ */
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .setting-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .setting-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary);
        }
        
        .setting-description {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        /* Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--card);
            padding: 30px;
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
        }
        
        /* Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius);
            padding: 15px;
            min-width: 300px;
            z-index: 10000;
            display: none;
        }
        
        .notification.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± -->
        <div class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-user-shield"></i> Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h1>
                <p>SODmAX Pro v2.0</p>
                <div id="currentUser" style="font-size: 12px; color: var(--text-secondary); margin-top: 10px;">
                    Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...
                </div>
            </div>
            
            <ul class="nav-menu">
                <li><a href="#" class="active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                </a></li>
                <li><a href="#" onclick="showSection('game-settings')">
                    <i class="fas fa-cogs"></i>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ
                </a></li>
                <li><a href="#" onclick="showSection('sale-plans')">
                    <i class="fas fa-shopping-cart"></i>Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´
                </a></li>
                <li><a href="#" onclick="showSection('missions')">
                    <i class="fas fa-tasks"></i>Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§
                </a></li>
                <li><a href="#" onclick="showSection('users')">
                    <i class="fas fa-users"></i>Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                </a></li>
                <li><a href="#" onclick="showSection('transactions')">
                    <i class="fas fa-exchange-alt"></i>ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
                </a></li>
                <li><a href="#" onclick="showSection('reports')">
                    <i class="fas fa-chart-bar"></i>Ú¯Ø²Ø§Ø±Ø´Ø§Øª
                </a></li>
                <li><a href="index.html" style="color: var(--accent);">
                    <i class="fas fa-gamepad"></i>Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ
                </a></li>
                <li><a href="#" onclick="logout()" style="color: var(--error);">
                    <i class="fas fa-sign-out-alt"></i>Ø®Ø±ÙˆØ¬
                </a></li>
            </ul>
        </div>
        
        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
        <div class="main-content">
            <!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
            <div class="content-section active" id="dashboard-section">
                <div class="header">
                    <h1><i class="fas fa-tachometer-alt"></i> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª</h1>
                    <div id="lastUpdate">Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª: Ù‡Ù…â€ŒØ§Ú©Ù†ÙˆÙ†</div>
                </div>
                
                <div class="stats-grid" id="dashboardStats">
                    <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
                
                <div class="content-section" style="border: none; padding: 0;">
                    <h2>Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§</h2>
                    <div id="recentActivity">
                        <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                </div>
            </div>
            
            <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ -->
            <div class="content-section" id="game-settings-section">
                <div class="section-header">
                    <h2><i class="fas fa-cogs"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§Ø²ÛŒ</h2>
                    <button class="btn btn-success" onclick="saveAllSettings()">
                        <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ Ù‡Ù…Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                    </button>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="showSettingsTab('mining')">âš™ï¸ Ø§Ø³ØªØ®Ø±Ø§Ø¬</div>
                    <div class="tab" onclick="showSettingsTab('progress')">ğŸ“ˆ Ù¾ÛŒØ´Ø±ÙØª</div>
                    <div class="tab" onclick="showSettingsTab('economy')">ğŸ’° Ø§Ù‚ØªØµØ§Ø¯</div>
                    <div class="tab" onclick="showSettingsTab('other')">âš¡ Ø³Ø§ÛŒØ±</div>
                </div>
                
                <!-- ØªØ¨ Ø§Ø³ØªØ®Ø±Ø§Ø¬ -->
                <div class="tab-content active" id="mining-settings">
                    <div class="settings-grid" id="miningSettings">
                        <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                </div>
                
                <!-- ØªØ¨ Ù¾ÛŒØ´Ø±ÙØª -->
                <div class="tab-content" id="progress-settings">
                    <div class="settings-grid" id="progressSettings">
                        <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                </div>
                
                <!-- ØªØ¨ Ø§Ù‚ØªØµØ§Ø¯ -->
                <div class="tab-content" id="economy-settings">
                    <div class="settings-grid" id="economySettings">
                        <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                </div>
                
                <!-- ØªØ¨ Ø³Ø§ÛŒØ± -->
                <div class="tab-content" id="other-settings">
                    <div class="settings-grid" id="otherSettings">
                        <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                </div>
            </div>
            
            <!-- Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´ -->
            <div class="content-section" id="sale-plans-section">
                <div class="section-header">
                    <h2><i class="fas fa-shopping-cart"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´</h2>
                    <button class="btn btn-primary" onclick="showEditPlanModal(null)">
                        <i class="fas fa-plus"></i> Ù¾Ù†Ù„ Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ù†Ø§Ù… Ù¾Ù†Ù„</th>
                                <th>Ù‚ÛŒÙ…Øª (USDT)</th>
                                <th>SOD Ø§ØµÙ„ÛŒ</th>
                                <th>ØªØ®ÙÛŒÙ</th>
                                <th>Ù¾Ø§Ø¯Ø§Ø´</th>
                                <th>ÙˆÛŒÚ˜Ù‡</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="salePlansTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ -->
            <div class="content-section" id="missions-section">
                <div class="section-header">
                    <h2><i class="fas fa-tasks"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§</h2>
                    <button class="btn btn-primary" onclick="showEditMissionModal(null)">
                        <i class="fas fa-plus"></i> Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>Ù‡Ø¯Ù</th>
                                <th>Ù¾Ø§Ø¯Ø§Ø´ SOD</th>
                                <th>Ù¾Ø§Ø¯Ø§Ø´ USDT</th>
                                <th>ØªØ¬Ø±Ø¨Ù‡</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="missionsTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
            <div class="content-section" id="users-section">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>
                    <div>
                        <input type="text" id="searchUsers" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±..." class="form-input" style="width: 200px;">
                        <button class="btn btn-primary" onclick="searchUsers()">
                            <i class="fas fa-search"></i> Ø¬Ø³ØªØ¬Ùˆ
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø§ÛŒÙ…ÛŒÙ„</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>Ø³Ø·Ø­</th>
                                <th>SOD</th>
                                <th>USDT</th>
                                <th>Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-outline" onclick="loadMoreUsers()" id="loadMoreBtn">
                        <i class="fas fa-arrow-down"></i> Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ± (20 Ú©Ø§Ø±Ø¨Ø±)
                    </button>
                </div>
            </div>
            
            <!-- ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ -->
            <div class="content-section" id="transactions-section">
                <div class="section-header">
                    <h2><i class="fas fa-exchange-alt"></i> ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h2>
                    <div>
                        <select id="transactionFilter" class="form-input" style="width: 150px;">
                            <option value="all">Ù‡Ù…Ù‡</option>
                            <option value="mining">Ø§Ø³ØªØ®Ø±Ø§Ø¬</option>
                            <option value="purchase">Ø®Ø±ÛŒØ¯</option>
                            <option value="usdt_reward">Ù¾Ø§Ø¯Ø§Ø´ USDT</option>
                            <option value="boost">Ø§ÙØ²Ø§ÛŒØ´ Ù‚Ø¯Ø±Øª</option>
                            <option value="withdrawal">Ø¨Ø±Ø¯Ø§Ø´Øª</option>
                        </select>
                        <button class="btn btn-primary" onclick="filterTransactions()">
                            <i class="fas fa-filter"></i> ÙÛŒÙ„ØªØ±
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ú©Ø§Ø±Ø¨Ø±</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>Ù…Ù‚Ø¯Ø§Ø±</th>
                                <th>ÙˆØ§Ø­Ø¯</th>
                                <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Ú¯Ø²Ø§Ø±Ø´Ø§Øª -->
            <div class="content-section" id="reports-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ùˆ Ø¢Ù…Ø§Ø±</h2>
                    <div>
                        <select id="reportPeriod" class="form-input" style="width: 150px;">
                            <option value="today">Ø§Ù…Ø±ÙˆØ²</option>
                            <option value="week">Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ</option>
                            <option value="month">Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ</option>
                            <option value="all">Ù‡Ù…Ù‡ Ø²Ù…Ø§Ù†</option>
                        </select>
                        <button class="btn btn-primary" onclick="generateReport()">
                            <i class="fas fa-chart-line"></i> Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²Ø§Ø±Ø´
                        </button>
                    </div>
                </div>
                
                <div id="reportContent">
                    <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† -->
    <div class="notification" id="notification">
        <div style="display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-check-circle" style="color: var(--success);"></i>
            <div>
                <strong id="notificationTitle">Ù…ÙˆÙÙ‚</strong>
                <p id="notificationMessage">Ø¹Ù…Ù„ÛŒØ§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯</p>
            </div>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ù†Ù„ -->
    <div class="modal" id="editPlanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ù†Ù„ ÙØ±ÙˆØ´</h3>
                <button class="modal-close" onclick="closeModal('editPlanModal')">Ã—</button>
            </div>
            <form id="planForm">
                <input type="hidden" id="planId">
                <div class="form-group">
                    <label class="form-label">Ù†Ø§Ù… Ù¾Ù†Ù„</label>
                    <input type="text" id="planName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù‚ÛŒÙ…Øª (USDT)</label>
                    <input type="number" id="planPrice" class="form-input" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù…Ù‚Ø¯Ø§Ø± SOD Ø§ØµÙ„ÛŒ</label>
                    <input type="number" id="planSodAmount" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø¯Ø±ØµØ¯ ØªØ®ÙÛŒÙ</label>
                    <input type="number" id="planDiscount" class="form-input" min="0" max="100" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø¯Ø±ØµØ¯ Ù¾Ø§Ø¯Ø§Ø´ Ø§Ø¶Ø§ÙÛŒ</label>
                    <input type="number" id="planBonus" class="form-input" min="0" max="100" value="5">
                </div>
                <div class="form-group">
                    <label class="form-label">ÙˆÛŒÚ˜Ù‡ (Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯)</label>
                    <input type="checkbox" id="planPopular">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ù‡</label>
                    <input type="checkbox" id="planFeatured">
                </div>
                <div class="form-group">
                    <label class="form-label">ØªØ±ØªÛŒØ¨ Ù†Ù…Ø§ÛŒØ´</label>
                    <input type="number" id="planOrder" class="form-input" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ (Ù‡Ø± Ø®Ø· ÛŒÚ© ÙˆÛŒÚ˜Ú¯ÛŒ)</label>
                    <textarea id="planFeatures" class="form-input" rows="4"></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deletePlan()" id="deletePlanBtn" style="display: none;">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø£Ù…ÙˆØ±ÛŒØª -->
    <div class="modal" id="editMissionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø£Ù…ÙˆØ±ÛŒØª</h3>
                <button class="modal-close" onclick="closeModal('editMissionModal')">Ã—</button>
            </div>
            <form id="missionForm">
                <input type="hidden" id="missionId">
                <div class="form-group">
                    <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ù…Ø£Ù…ÙˆØ±ÛŒØª</label>
                    <input type="text" id="missionTitle" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                    <textarea id="missionDescription" class="form-input" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù†ÙˆØ¹ Ù…Ø£Ù…ÙˆØ±ÛŒØª</label>
                    <select id="missionType" class="form-input">
                        <option value="daily">Ø±ÙˆØ²Ø§Ù†Ù‡</option>
                        <option value="weekly">Ù‡ÙØªÚ¯ÛŒ</option>
                        <option value="special">ÙˆÛŒÚ˜Ù‡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù†ÙˆØ¹ Ù‡Ø¯Ù</label>
                    <select id="missionTargetType" class="form-input">
                        <option value="manual_mining">ØªØ¹Ø¯Ø§Ø¯ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¯Ø³ØªÛŒ</option>
                        <option value="auto_mining">Ù…Ø¯Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø®ÙˆØ¯Ú©Ø§Ø± (Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡)</option>
                        <option value="use_boost">Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¨ÙˆØ³Øª</option>
                        <option value="buy_plans">Ø®Ø±ÛŒØ¯ Ù¾Ù†Ù„</option>
                        <option value="total_mining">SOD Ú©Ù„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡</option>
                        <option value="reach_level">Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Ø³Ø·Ø­</option>
                        <option value="invite_friends">Ø¯Ø¹ÙˆØª Ø¯ÙˆØ³ØªØ§Ù†</option>
                        <option value="buy_all_plans">Ø®Ø±ÛŒØ¯ ØªÙ…Ø§Ù… Ù¾Ù†Ù„â€ŒÙ‡Ø§</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù…Ù‚Ø¯Ø§Ø± Ù‡Ø¯Ù</label>
                    <input type="number" id="missionTarget" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù¾Ø§Ø¯Ø§Ø´ SOD</label>
                    <input type="number" id="missionRewardSod" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù¾Ø§Ø¯Ø§Ø´ USDT</label>
                    <input type="number" id="missionRewardUsdt" class="form-input" step="0.0001" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù¾Ø§Ø¯Ø§Ø´ ØªØ¬Ø±Ø¨Ù‡ (XP)</label>
                    <input type="number" id="missionRewardExp" class="form-input" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù‚Ø§Ø¨Ù„ ØªÚ©Ø±Ø§Ø±</label>
                    <input type="checkbox" id="missionRepeatable" checked>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø­Ø¯Ø§Ú©Ø«Ø± ØªÚ©Ø±Ø§Ø±</label>
                    <input type="number" id="missionMaxCompletions" class="form-input" value="1">
                </div>
                <div class="form-group">
                    <label class="form-label">ÙØ¹Ø§Ù„</label>
                    <input type="checkbox" id="missionActive" checked>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deleteMission()" id="deleteMissionBtn" style="display: none;">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± -->
    <div class="modal" id="editUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±</h3>
                <button class="modal-close" onclick="closeModal('editUserModal')">Ã—</button>
            </div>
            <form id="userForm">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label class="form-label">Ø§ÛŒÙ…ÛŒÙ„</label>
                    <input type="email" id="userEmail" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù†Ø§Ù… Ú©Ø§Ù…Ù„</label>
                    <input type="text" id="userFullName" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø³Ø·Ø­</label>
                    <input type="number" id="userLevel" class="form-input" min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ SOD</label>
                    <input type="number" id="userSod" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ USDT</label>
                    <input type="number" id="userUsdt" class="form-input" step="0.000001">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù‚Ø¯Ø±Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬</label>
                    <input type="number" id="userMiningPower" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">ØªØ¬Ø±Ø¨Ù‡ (XP)</label>
                    <input type="number" id="userExperience" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">ÙˆØ¶Ø¹ÛŒØª Ø­Ø³Ø§Ø¨</label>
                    <select id="userStatus" class="form-input">
                        <option value="active">ÙØ¹Ø§Ù„</option>
                        <option value="suspended">ØªØ¹Ù„ÛŒÙ‚</option>
                        <option value="banned">Ù…Ø³Ø¯ÙˆØ¯</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                    </button>
                    <button type="button" class="btn btn-danger" onclick="resetUserPassword()">
                        <i class="fas fa-key"></i> Ø±ÛŒØ³Øª Ø±Ù…Ø²
                    </button>
                </div>
            </form>
        </div>
    </div>
        <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // ============ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ú¯Ù„ÙˆØ¨Ø§Ù„ ============
        const SUPABASE_URL = 'https://wxxhulztrxmjqftxcetp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind4eGh1bHp0cnhtanFmdHhjZXRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNzEwNDcsImV4cCI6MjA4MTY0NzA0N30.iC6Ief8aF-zw66RQRSnLxA-BmAjChQj9xy4HkJpGOA4';
        
        let supabaseClient = null;
        let currentUser = null;
        let currentUserPage = 1;
        const usersPerPage = 20;
        let gameSettings = {};
        let salePlans = [];
        let missions = [];
        let withdrawalRequests = [];
        let walletSettings = {};
        
        // ============ ÙˆÙ‚ØªÛŒ DOM Ù„ÙˆØ¯ Ø´Ø¯ ============
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Admin panel loaded');
            
            // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Supabase Client
            supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
            if (!await checkAuth()) {
                return;
            }
            
            // Ø¢Ù¾Ø¯ÛŒØª UI Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
            updateUserUI();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            await loadDashboardData();
            await loadGameSettings();
            await loadSalePlans();
            await loadMissions();
            await loadUsers();
            await loadTransactions();
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ù†ÙˆÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„
            addAdminMenuItems();
            
            // Ø¨Ø§ÛŒÙ†Ø¯ Ú©Ø±Ø¯Ù† Ø§ÛŒÙˆÙ†Øªâ€ŒÙ‡Ø§
            document.getElementById('planForm').addEventListener('submit', savePlan);
            document.getElementById('missionForm').addEventListener('submit', saveMission);
            document.getElementById('userForm').addEventListener('submit', saveUser);
            
            // Ø±ÛŒÙØ±Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± 30 Ø«Ø§Ù†ÛŒÙ‡
            setInterval(updateDashboard, 30000);
            
            console.log('âœ… Admin panel initialized successfully');
        });
        
        // ============ ØªÙˆØ§Ø¨Ø¹ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª ============
        async function checkAuth() {
            // Ø±ÙˆØ´ Û±: Ú†Ú© Ø§Ø² localStorage Ø¨Ø§Ø²ÛŒ
            const userData = localStorage.getItem('sodmax_user');
            if (userData) {
                try {
                    currentUser = JSON.parse(userData);
                    console.log('ğŸ“± User from game localStorage:', currentUser.email);
                } catch (e) {
                    console.warn('âŒ Could not parse sodmax_user:', e);
                }
            }
            
            // Ø±ÙˆØ´ Û²: Ú†Ú© Ø§Ø² Supabase Auth
            if (!currentUser && supabaseClient) {
                try {
                    const { data: { session }, error } = await supabaseClient.auth.getSession();
                    if (error) throw error;
                    
                    if (session?.user) {
                        currentUser = session.user;
                        console.log('ğŸ” User from Supabase Auth:', currentUser.email);
                    }
                } catch (e) {
                    console.warn('âŒ Supabase auth check failed:', e);
                }
            }
            
            // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯
            if (!currentUser) {
                alert('âš ï¸ Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø§Ø² ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯.');
                window.location.href = 'index.html';
                return false;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø¨ÙˆØ¯Ù†
            const adminEmails = [
                'hamyarhf@gmail.com',
                'hamyarhf@Gmail.com',
                'Hamyarhf@gmail.com',
                'admin@sodmax.com',
                'test@admin.com'
            ].map(email => email.toLowerCase());
            
            const userEmailLower = currentUser.email?.toLowerCase().trim();
            
            if (!adminEmails.includes(userEmailLower)) {
                alert(`âš ï¸ Ø§ÛŒÙ† ØµÙØ­Ù‡ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±Ø§Ù† Ø³ÛŒØ³ØªÙ… Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø³Øª.\n\nØ§ÛŒÙ…ÛŒÙ„ Ø´Ù…Ø§: ${currentUser.email}`);
                window.location.href = 'index.html';
                return false;
            }
            
            console.log('âœ… Admin access granted for:', currentUser.email);
            localStorage.setItem('sodmax_admin', 'true');
            
            return true;
        }
        
        function updateUserUI() {
            if (!currentUser) return;
            
            const userElement = document.getElementById('currentUser');
            if (userElement) {
                userElement.innerHTML = `
                    <div>ğŸ‘¤ ${currentUser.email}</div>
                    <div style="color: var(--success); font-size: 10px;">ğŸ” Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</div>
                `;
            }
        }
        
        async function logout() {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
                localStorage.removeItem('sodmax_user');
                localStorage.removeItem('sodmax_admin');
                
                if (supabaseClient) {
                    await supabaseClient.auth.signOut();
                }
                
                window.location.href = 'index.html';
            }
        }
        
        // ============ ØªÙˆØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´â€ŒÙ‡Ø§ ============
        function showSection(sectionId) {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Ø¢Ù¾Ø¯ÛŒØª Ù…Ù†Ùˆ
            document.querySelectorAll('.nav-menu a').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±
            const section = document.getElementById(sectionId + '-section');
            if (section) {
                section.classList.add('active');
            }
        }
        
        function showSettingsTab(tabName) {
            // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØªØ¨â€ŒÙ‡Ø§
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªØ¨ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            event.target.classList.add('active');
            document.getElementById(tabName + '-settings').classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function showNotification(title, message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // ØªÙ†Ø¸ÛŒÙ… Ø±Ù†Ú¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹
            const icon = notification.querySelector('i');
            if (icon) {
                if (type === 'error') {
                    icon.className = 'fas fa-exclamation-circle';
                    icon.style.color = 'var(--error)';
                } else if (type === 'warning') {
                    icon.className = 'fas fa-exclamation-triangle';
                    icon.style.color = 'var(--warning)';
                } else {
                    icon.className = 'fas fa-check-circle';
                    icon.style.color = 'var(--success)';
                }
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        
        // ============ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ============
        async function loadDashboardData() {
            try {
                const statsGrid = document.getElementById('dashboardStats');
                if (!statsGrid) return;
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø± Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
                const { data: users, error: usersError } = await supabaseClient
                    .from('users')
                    .select('count');
                
                const { data: transactions, error: transError } = await supabaseClient
                    .from('transactions')
                    .select('count');
                
                const { data: totalSodData, error: sodError } = await supabaseClient
                    .from('users')
                    .select('sod_balance');
                
                const { data: recentUsers, error: recentError } = await supabaseClient
                    .from('users')
                    .select('*')
                    .order('last_login', { ascending: false })
                    .limit(5);
                
                // Ù…Ø­Ø§Ø³Ø¨Ø§Øª
                const userCount = users ? users[0]?.count : 0;
                const transactionCount = transactions ? transactions[0]?.count : 0;
                let totalSod = 0;
                if (totalSodData) {
                    totalSod = totalSodData.reduce((sum, user) => sum + (user.sod_balance || 0), 0);
                }
                
                // Ø¢Ù¾Ø¯ÛŒØª UI
                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <h3>ğŸ‘¥ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ú©Ù„</h3>
                        <div class="value">${userCount}</div>
                    </div>
                    <div class="stat-card">
                        <h3>ğŸ’³ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h3>
                        <div class="value">${transactionCount}</div>
                    </div>
                    <div class="stat-card">
                        <h3>ğŸ’° SOD Ú©Ù„ Ø´Ø¨Ú©Ù‡</h3>
                        <div class="value">${formatNumber(totalSod)}</div>
                    </div>
                    <div class="stat-card">
                        <h3>ğŸ“Š Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§</h3>
                        <div class="value">${missions.length}</div>
                    </div>
                `;
                
                // Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
                const recentActivity = document.getElementById('recentActivity');
                if (recentActivity && recentUsers) {
                    recentActivity.innerHTML = recentUsers.map(user => `
                        <div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <div>
                                <strong>${user.full_name || user.email}</strong>
                                <div style="font-size: 12px; color: var(--text-secondary);">
                                    Ø³Ø·Ø­ ${user.level || 1} â€¢ ${formatNumber(user.sod_balance || 0)} SOD
                                </div>
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                ${new Date(user.last_login).toLocaleString('fa-IR')}
                            </div>
                        </div>
                    `).join('');
                }
                
                // Ø¢Ù¾Ø¯ÛŒØª ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                document.getElementById('lastUpdate').textContent = 
                    `Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª: ${new Date().toLocaleTimeString('fa-IR')}`;
                    
            } catch (error) {
                console.error('âŒ Error loading dashboard:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯', 'error');
            }
        }
        
        function updateDashboard() {
            loadDashboardData();
        }
        
        // ============ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ ============
        async function loadGameSettings() {
            try {
                const { data, error } = await supabaseClient
                    .from('game_settings')
                    .select('*')
                    .order('setting_key');
                
                if (error) throw error;
                
                gameSettings = {};
                if (data) {
                    data.forEach(setting => {
                        gameSettings[setting.setting_key] = {
                            value: setting.setting_value,
                            description: setting.description,
                            data_type: setting.data_type || 'string'
                        };
                    });
                }
                
                renderGameSettings();
                
            } catch (error) {
                console.error('âŒ Error loading game settings:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª', 'error');
            }
        }
        
        function renderGameSettings() {
            // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            const miningSettings = {};
            const progressSettings = {};
            const economySettings = {};
            const otherSettings = {};
            
            Object.keys(gameSettings).forEach(key => {
                if (key.includes('mining') || key.includes('boost') || key.includes('auto')) {
                    miningSettings[key] = gameSettings[key];
                } else if (key.includes('level') || key.includes('mission') || key.includes('progress') || key.includes('experience')) {
                    progressSettings[key] = gameSettings[key];
                } else if (key.includes('sale') || key.includes('price') || key.includes('usdt') || key.includes('referral')) {
                    economySettings[key] = gameSettings[key];
                } else {
                    otherSettings[key] = gameSettings[key];
                }
            });
            
            // Ø±Ù†Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬
            renderSettingsCategory('miningSettings', miningSettings);
            renderSettingsCategory('progressSettings', progressSettings);
            renderSettingsCategory('economySettings', economySettings);
            renderSettingsCategory('otherSettings', otherSettings);
        }
        
        function renderSettingsCategory(containerId, settings) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = Object.keys(settings).map(key => `
                <div class="setting-card">
                    <div class="setting-title">${key.replace(/_/g, ' ')}</div>
                    <div class="setting-description">${settings[key].description || ''}</div>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <input type="${getInputType(settings[key].data_type)}" 
                               class="form-input" 
                               value="${settings[key].value}"
                               data-key="${key}"
                               style="flex: 1;">
                        <button class="btn btn-primary btn-sm" onclick="updateSetting('${key}', this.previousElementSibling.value)">
                            <i class="fas fa-save"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function getInputType(dataType) {
            const types = {
                'number': 'number',
                'boolean': 'checkbox',
                'json': 'text',
                'string': 'text'
            };
            return types[dataType] || 'text';
        }
        
        async function updateSetting(key, value) {
            try {
                const { error } = await supabaseClient
                    .from('game_settings')
                    .update({ 
                        setting_value: value,
                        updated_at: new Date().toISOString()
                    })
                    .eq('setting_key', key);
                
                if (error) throw error;
                
                showNotification('Ù…ÙˆÙÙ‚', `ØªÙ†Ø¸ÛŒÙ… ${key} Ø¨Ù‡ Ø±ÙˆØ² Ø´Ø¯`);
                
            } catch (error) {
                console.error('âŒ Error updating setting:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªÙ†Ø¸ÛŒÙ…', 'error');
            }
        }
        
        async function saveAllSettings() {
            try {
                const updates = [];
                const inputs = document.querySelectorAll('[data-key]');
                
                for (const input of inputs) {
                    const key = input.dataset.key;
                    const value = input.value;
                    
                    updates.push(
                        supabaseClient
                            .from('game_settings')
                            .update({ 
                                setting_value: value,
                                updated_at: new Date().toISOString()
                            })
                            .eq('setting_key', key)
                    );
                }
                
                await Promise.all(updates);
                showNotification('Ù…ÙˆÙÙ‚', 'Ù‡Ù…Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯');
                
            } catch (error) {
                console.error('âŒ Error saving settings:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª', 'error');
            }
        }
        
        // ============ Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´ ============
        async function loadSalePlans() {
            try {
                const { data, error } = await supabaseClient
                    .from('sale_plans')
                    .select('*')
                    .order('order_index');
                
                if (error) throw error;
                
                salePlans = data || [];
                renderSalePlans();
                
            } catch (error) {
                console.error('âŒ Error loading sale plans:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ù†Ù„â€ŒÙ‡Ø§', 'error');
            }
        }
        
        function renderSalePlans() {
            const table = document.getElementById('salePlansTable');
            if (!table) return;
            
            table.innerHTML = salePlans.map((plan, index) => {
                const totalSod = plan.sod_amount + Math.floor(plan.sod_amount * ((plan.discount + plan.bonus_percentage) / 100));
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${plan.name}</td>
                        <td>${plan.price} USDT</td>
                        <td>${formatNumber(plan.sod_amount)}</td>
                        <td>${plan.discount}%</td>
                        <td>${plan.bonus_percentage}%</td>
                        <td>${plan.popular ? 'â­' : 'â€”'} ${plan.featured ? 'ğŸ”¥' : ''}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="showEditPlanModal(${plan.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deletePlan(${plan.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function showEditPlanModal(planId) {
            const modal = document.getElementById('editPlanModal');
            const form = document.getElementById('planForm');
            const deleteBtn = document.getElementById('deletePlanBtn');
            
            if (planId) {
                // Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´
                const plan = salePlans.find(p => p.id === planId);
                if (plan) {
                    document.getElementById('planId').value = plan.id;
                    document.getElementById('planName').value = plan.name;
                    document.getElementById('planPrice').value = plan.price;
                    document.getElementById('planSodAmount').value = plan.sod_amount;
                    document.getElementById('planDiscount').value = plan.discount || 0;
                    document.getElementById('planBonus').value = plan.bonus_percentage || 5;
                    document.getElementById('planPopular').checked = plan.popular || false;
                    document.getElementById('planFeatured').checked = plan.featured || false;
                    document.getElementById('planOrder').value = plan.order_index || 0;
                    document.getElementById('planFeatures').value = Array.isArray(plan.features) ? 
                        plan.features.join('\n') : '';
                    
                    deleteBtn.style.display = 'inline-block';
                }
            } else {
                // Ø­Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯
                form.reset();
                document.getElementById('planId').value = '';
                deleteBtn.style.display = 'none';
            }
            
            modal.classList.add('active');
        }
        
        async function savePlan(e) {
            e.preventDefault();
            
            const planId = document.getElementById('planId').value;
            const planData = {
                name: document.getElementById('planName').value,
                price: parseFloat(document.getElementById('planPrice').value),
                sod_amount: parseInt(document.getElementById('planSodAmount').value),
                discount: parseInt(document.getElementById('planDiscount').value) || 0,
                bonus_percentage: parseInt(document.getElementById('planBonus').value) || 5,
                popular: document.getElementById('planPopular').checked,
                featured: document.getElementById('planFeatured').checked,
                order_index: parseInt(document.getElementById('planOrder').value) || 0,
                features: document.getElementById('planFeatures').value.split('\n').filter(f => f.trim())
            };
            
            try {
                if (planId) {
                    // Ø¢Ù¾Ø¯ÛŒØª Ù¾Ù†Ù„ Ù…ÙˆØ¬ÙˆØ¯
                    const { error } = await supabaseClient
                        .from('sale_plans')
                        .update(planData)
                        .eq('id', planId);
                    
                    if (error) throw error;
                    
                    showNotification('Ù…ÙˆÙÙ‚', 'Ù¾Ù†Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ø±ÙˆØ² Ø´Ø¯');
                } else {
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ù†Ù„ Ø¬Ø¯ÛŒØ¯
                    const { error } = await supabaseClient
                        .from('sale_plans')
                        .insert([planData]);
                    
                    if (error) throw error;
                    
                    showNotification('Ù…ÙˆÙÙ‚', 'Ù¾Ù†Ù„ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯');
                }
                
                closeModal('editPlanModal');
                await loadSalePlans();
                
            } catch (error) {
                console.error('âŒ Error saving plan:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾Ù†Ù„', 'error');
            }
        }
        
        async function deletePlan(planId) {
            if (!confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù¾Ù†Ù„ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('sale_plans')
                    .delete()
                    .eq('id', planId);
                
                if (error) throw error;
                
                await loadSalePlans();
                showNotification('Ù…ÙˆÙÙ‚', 'Ù¾Ù†Ù„ Ø­Ø°Ù Ø´Ø¯');
                
            } catch (error) {
                console.error('âŒ Error deleting plan:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾Ù†Ù„', 'error');
            }
        }
        
        // ============ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ ============
        async function loadMissions() {
            try {
                const { data, error } = await supabaseClient
                    .from('missions')
                    .select('*')
                    .order('order_index');
                
                if (error) throw error;
                
                missions = data || [];
                renderMissions();
                
            } catch (error) {
                console.error('âŒ Error loading missions:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§', 'error');
            }
        }
        
        function renderMissions() {
            const table = document.getElementById('missionsTable');
            if (!table) return;
            
            table.innerHTML = missions.map((mission, index) => {
                const requirements = mission.requirements || {};
                const rewards = mission.rewards || {};
                
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${mission.title}</td>
                        <td>${mission.mission_type === 'daily' ? 'Ø±ÙˆØ²Ø§Ù†Ù‡' : 
                               mission.mission_type === 'weekly' ? 'Ù‡ÙØªÚ¯ÛŒ' : 'ÙˆÛŒÚ˜Ù‡'}</td>
                        <td>${requirements.target || 0} ${getMissionTargetUnit(requirements.type)}</td>
                        <td>${formatNumber(rewards.sod || 0)}</td>
                        <td>${rewards.usdt || 0}</td>
                        <td>${rewards.exp || 0}</td>
                        <td>${mission.is_active ? 'âœ… ÙØ¹Ø§Ù„' : 'âŒ ØºÛŒØ±ÙØ¹Ø§Ù„'}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="showEditMissionModal(${mission.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteMission(${mission.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function getMissionTargetUnit(type) {
            const units = {
                'manual_mining': 'Ø¨Ø§Ø±',
                'auto_mining': 'Ø¯Ù‚ÛŒÙ‚Ù‡',
                'use_boost': 'Ø¨Ø§Ø±',
                'buy_plans': 'Ø¹Ø¯Ø¯',
                'total_mining': 'SOD',
                'reach_level': 'Ø³Ø·Ø­',
                'invite_friends': 'Ù†ÙØ±',
                'buy_all_plans': 'Ø¹Ø¯Ø¯'
            };
            return units[type] || '';
        }
        
        function showEditMissionModal(missionId) {
            const modal = document.getElementById('editMissionModal');
            const form = document.getElementById('missionForm');
            const deleteBtn = document.getElementById('deleteMissionBtn');
            
            if (missionId) {
                // Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´
                const mission = missions.find(m => m.id === missionId);
                if (mission) {
                    const requirements = mission.requirements || {};
                    const rewards = mission.rewards || {};
                    
                    document.getElementById('missionId').value = mission.id;
                    document.getElementById('missionTitle').value = mission.title;
                    document.getElementById('missionDescription').value = mission.description || '';
                    document.getElementById('missionType').value = mission.mission_type;
                    document.getElementById('missionTargetType').value = requirements.type || 'manual_mining';
                    document.getElementById('missionTarget').value = requirements.target || 0;
                    document.getElementById('missionRewardSod').value = rewards.sod || 0;
                    document.getElementById('missionRewardUsdt').value = rewards.usdt || 0;
                    document.getElementById('missionRewardExp').value = rewards.exp || 0;
                    document.getElementById('missionRepeatable').checked = mission.repeatable || false;
                    document.getElementById('missionMaxCompletions').value = mission.max_completions || 1;
                    document.getElementById('missionActive').checked = mission.is_active;
                    
                    deleteBtn.style.display = 'inline-block';
                }
            } else {
                // Ø­Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯
                form.reset();
                document.getElementById('missionId').value = '';
                deleteBtn.style.display = 'none';
            }
            
            modal.classList.add('active');
        }
        
        async function saveMission(e) {
            e.preventDefault();
            
            const missionId = document.getElementById('missionId').value;
            const missionData = {
                title: document.getElementById('missionTitle').value,
                description: document.getElementById('missionDescription').value,
                mission_type: document.getElementById('missionType').value,
                requirements: JSON.stringify({
                    type: document.getElementById('missionTargetType').value,
                    target: parseInt(document.getElementById('missionTarget').value),
                    current: 0
                }),
                rewards: JSON.stringify({
                    sod: parseInt(document.getElementById('missionRewardSod').value),
                    usdt: parseFloat(document.getElementById('missionRewardUsdt').value),
                    exp: parseInt(document.getElementById('missionRewardExp').value)
                }),
                repeatable: document.getElementById('missionRepeatable').checked,
                max_completions: parseInt(document.getElementById('missionMaxCompletions').value),
                is_active: document.getElementById('missionActive').checked,
                order_index: missions.length + 1
            };
            
            try {
                if (missionId) {
                    // Ø¢Ù¾Ø¯ÛŒØª Ù…Ø£Ù…ÙˆØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯
                    const { error } = await supabaseClient
                        .from('missions')
                        .update(missionData)
                        .eq('id', missionId);
                    
                    if (error) throw error;
                    
                    showNotification('Ù…ÙˆÙÙ‚', 'Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø¨Ù‡ Ø±ÙˆØ² Ø´Ø¯');
                } else {
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø¬Ø¯ÛŒØ¯
                    const { error } = await supabaseClient
                        .from('missions')
                        .insert([missionData]);
                    
                    if (error) throw error;
                    
                    showNotification('Ù…ÙˆÙÙ‚', 'Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯');
                }
                
                closeModal('editMissionModal');
                await loadMissions();
                
            } catch (error) {
                console.error('âŒ Error saving mission:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…Ø£Ù…ÙˆØ±ÛŒØª', 'error');
            }
        }
        
        async function deleteMission(missionId) {
            if (!confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('missions')
                    .delete()
                    .eq('id', missionId);
                
                if (error) throw error;
                
                await loadMissions();
                showNotification('Ù…ÙˆÙÙ‚', 'Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø­Ø°Ù Ø´Ø¯');
                
            } catch (error) {
                console.error('âŒ Error deleting mission:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù…Ø£Ù…ÙˆØ±ÛŒØª', 'error');
            }
        }
        
        // ============ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ============
        async function loadUsers() {
            try {
                const offset = (currentUserPage - 1) * usersPerPage;
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .range(offset, offset + usersPerPage - 1);
                
                if (error) throw error;
                
                renderUsers(data || []);
                
            } catch (error) {
                console.error('âŒ Error loading users:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†', 'error');
            }
        }
        
        function renderUsers(users) {
            const table = document.getElementById('usersTable');
            if (!table) return;
            
            table.innerHTML = users.map((user, index) => {
                const rowNum = (currentUserPage - 1) * usersPerPage + index + 1;
                return `
                    <tr>
                        <td>${rowNum}</td>
                        <td>${user.email}</td>
                        <td>${user.full_name || 'â€”'}</td>
                        <td>${user.level || 1}</td>
                        <td>${formatNumber(user.sod_balance || 0)}</td>
                        <td>${(user.usdt_balance || 0).toFixed(4)}</td>
                        <td>${user.last_login ? new Date(user.last_login).toLocaleDateString('fa-IR') : 'â€”'}</td>
                        <td>
                            <span style="color: ${user.status === 'active' ? 'var(--success)' : 
                                          user.status === 'suspended' ? 'var(--warning)' : 'var(--error)'};">
                                ${user.status === 'active' ? 'âœ… ÙØ¹Ø§Ù„' : 
                                  user.status === 'suspended' ? 'âš ï¸ ØªØ¹Ù„ÛŒÙ‚' : 'âŒ Ù…Ø³Ø¯ÙˆØ¯'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="showEditUserModal('${user.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="suspendUser('${user.id}')">
                                <i class="fas fa-pause"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Ø¢Ù¾Ø¯ÛŒØª Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ±
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            if (loadMoreBtn) {
                loadMoreBtn.textContent = `Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ± (${usersPerPage} Ú©Ø§Ø±Ø¨Ø±)`;
            }
        }
        
        async function loadMoreUsers() {
            currentUserPage++;
            await loadUsers();
        }
        
        async function searchUsers() {
            const searchTerm = document.getElementById('searchUsers').value.toLowerCase();
            if (!searchTerm) {
                currentUserPage = 1;
                await loadUsers();
                return;
            }
            
            try {
                const { data: users, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .or(`email.ilike.%${searchTerm}%,full_name.ilike.%${searchTerm}%`)
                    .limit(50);
                
                if (error) throw error;
                
                renderUsers(users || []);
                
                // ØªØºÛŒÛŒØ± Ù…ØªÙ† Ø¯Ú©Ù…Ù‡
                const loadMoreBtn = document.getElementById('loadMoreBtn');
                if (loadMoreBtn) {
                    loadMoreBtn.textContent = `Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ: ${users?.length || 0} Ú©Ø§Ø±Ø¨Ø±`;
                }
                
            } catch (error) {
                console.error('âŒ Error searching users:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†', 'error');
            }
        }
        
        async function showEditUserModal(userId) {
            try {
                const { data: user, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('id', userId)
                    .single();
                
                if (error) throw error;
                
                document.getElementById('userId').value = user.id;
                document.getElementById('userEmail').value = user.email;
                document.getElementById('userFullName').value = user.full_name || '';
                document.getElementById('userLevel').value = user.level || 1;
                document.getElementById('userSod').value = user.sod_balance || 0;
                document.getElementById('userUsdt').value = user.usdt_balance || 0;
                document.getElementById('userMiningPower').value = user.mining_power || 10;
                document.getElementById('userExperience').value = user.experience || 0;
                document.getElementById('userStatus').value = user.status || 'active';
                
                document.getElementById('editUserModal').classList.add('active');
                
            } catch (error) {
                console.error('âŒ Error loading user:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±', 'error');
            }
        }
        
        async function saveUser(e) {
            e.preventDefault();
            
            const userId = document.getElementById('userId').value;
            const userData = {
                full_name: document.getElementById('userFullName').value,
                level: parseInt(document.getElementById('userLevel').value),
                sod_balance: parseInt(document.getElementById('userSod').value),
                usdt_balance: parseFloat(document.getElementById('userUsdt').value),
                mining_power: parseInt(document.getElementById('userMiningPower').value),
                experience: parseInt(document.getElementById('userExperience').value),
                status: document.getElementById('userStatus').value
            };
            
            try {
                const { error } = await supabaseClient
                    .from('users')
                    .update(userData)
                    .eq('id', userId);
                
                if (error) throw error;
                
                closeModal('editUserModal');
                await loadUsers();
                showNotification('Ù…ÙˆÙÙ‚', 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø±ÙˆØ² Ø´Ø¯');
                
            } catch (error) {
                console.error('âŒ Error saving user:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±', 'error');
            }
        }
        
        async function suspendUser(userId) {
            if (!confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ ØªØ¹Ù„ÛŒÙ‚ Ú©Ù†ÛŒØ¯ØŸ')) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('users')
                    .update({ status: 'suspended' })
                    .eq('id', userId);
                
                if (error) throw error;
                
                await loadUsers();
                showNotification('Ù…ÙˆÙÙ‚', 'Ú©Ø§Ø±Ø¨Ø± ØªØ¹Ù„ÛŒÙ‚ Ø´Ø¯');
                
            } catch (error) {
                console.error('âŒ Error suspending user:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± ØªØ¹Ù„ÛŒÙ‚ Ú©Ø§Ø±Ø¨Ø±', 'error');
            }
        }
        
        function resetUserPassword() {
            const userId = document.getElementById('userId').value;
            const userEmail = document.getElementById('userEmail').value;
            
            if (confirm(`Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ú©Ø§Ø±Ø¨Ø± ${userEmail} Ø±ÛŒØ³Øª Ø´ÙˆØ¯ØŸ Ù„ÛŒÙ†Ú© Ø±ÛŒØ³Øª Ø¨Ù‡ Ø§ÛŒÙ…ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø± Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.`)) {
                // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª SMTP Ø¯Ø± Supabase Ø¯Ø§Ø±Ø¯
                showNotification('ØªÙˆØ¬Ù‡', 'Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ… SMTP Ø¯Ø± Supabase Ø¯Ø§Ø±Ø¯', 'warning');
            }
        }
        
        // ============ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ ============
        async function loadTransactions() {
            try {
                const { data: transactions, error } = await supabaseClient
                    .from('transactions')
                    .select(`
                        *,
                        users (email)
                    `)
                    .order('created_at', { ascending: false })
                    .limit(50);
                
                if (error) throw error;
                
                renderTransactions(transactions || []);
                
            } catch (error) {
                console.error('âŒ Error loading transactions:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§', 'error');
            }
        }
        
        function renderTransactions(transactions) {
            const table = document.getElementById('transactionsTable');
            if (!table) return;
            
            table.innerHTML = transactions.map((t, index) => {
                const userEmail = t.users?.email || 'Ù†Ø§Ø´Ù†Ø§Ø³';
                const amountColor = t.amount >= 0 ? 'var(--success)' : 'var(--error)';
                const amountSign = t.amount >= 0 ? '+' : '';
                
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${userEmail}</td>
                        <td>${getTransactionTypeText(t.type)}</td>
                        <td style="color: ${amountColor}">${amountSign}${Math.abs(t.amount).toLocaleString()}</td>
                        <td>${t.currency}</td>
                        <td>${t.description || 'â€”'}</td>
                        <td>${new Date(t.created_at).toLocaleString('fa-IR')}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function getTransactionTypeText(type) {
            const types = {
                'mining': 'Ø§Ø³ØªØ®Ø±Ø§Ø¬',
                'purchase': 'Ø®Ø±ÛŒØ¯',
                'usdt_reward': 'Ù¾Ø§Ø¯Ø§Ø´ USDT',
                'boost': 'Ø§ÙØ²Ø§ÛŒØ´ Ù‚Ø¯Ø±Øª',
                'withdrawal': 'Ø¨Ø±Ø¯Ø§Ø´Øª',
                'bonus': 'Ù¾Ø§Ø¯Ø§Ø´'
            };
            return types[type] || type;
        }
        
        async function filterTransactions() {
            const filterValue = document.getElementById('transactionFilter').value;
            
            try {
                let query = supabaseClient
                    .from('transactions')
                    .select(`
                        *,
                        users (email)
                    `)
                    .order('created_at', { ascending: false })
                    .limit(50);
                
                if (filterValue !== 'all') {
                    query = query.eq('type', filterValue);
                }
                
                const { data: transactions, error } = await query;
                
                if (error) throw error;
                
                renderTransactions(transactions || []);
                
            } catch (error) {
                console.error('âŒ Error filtering transactions:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± ÙÛŒÙ„ØªØ± ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§', 'error');
            }
        }
        
        // ============ Ú¯Ø²Ø§Ø±Ø´Ø§Øª ============
        async function generateReport() {
            const period = document.getElementById('reportPeriod').value;
            const reportContent = document.getElementById('reportContent');
            
            reportContent.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="fas fa-chart-line" style="font-size: 48px; margin-bottom: 20px;"></i>
                    <h3>Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´ ${period === 'today' ? 'Ø§Ù…Ø±ÙˆØ²' : 
                                period === 'week' ? 'Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ' : 
                                period === 'month' ? 'Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ' : 'Ù‡Ù…Ù‡ Ø²Ù…Ø§Ù†'}...</h3>
                    <p>Ù„Ø·ÙØ§Ù‹ Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡ ØµØ¨Ø± Ú©Ù†ÛŒØ¯</p>
                </div>
            `;
            
            try {
                // Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ú¯Ø²Ø§Ø±Ø´
                let dateFilter = '';
                if (period === 'today') {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    dateFilter = today.toISOString();
                } else if (period === 'week') {
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    dateFilter = weekAgo.toISOString();
                } else if (period === 'month') {
                    const monthAgo = new Date();
                    monthAgo.setMonth(monthAgo.getMonth() - 1);
                    dateFilter = monthAgo.toISOString();
                }
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø±
                const { data: usersData } = await supabaseClient
                    .from('users')
                    .select('count')
                    .maybeSingle();
                
                const { data: newUsersData } = dateFilter ? await supabaseClient
                    .from('users')
                    .select('count')
                    .gte('created_at', dateFilter)
                    .maybeSingle() : { data: null };
                
                const { data: transactionsData } = dateFilter ? await supabaseClient
                    .from('transactions')
                    .select('amount, currency')
                    .gte('created_at', dateFilter) : { data: [] };
                
                // Ù…Ø­Ø§Ø³Ø¨Ø§Øª
                const totalUsers = usersData?.count || 0;
                const newUsers = newUsersData?.count || 0;
                
                let totalRevenue = 0;
                let totalSodMined = 0;
                
                if (transactionsData) {
                    transactionsData.forEach(t => {
                        if (t.currency === 'USDT' && t.amount > 0) {
                            totalRevenue += t.amount;
                        }
                        if (t.currency === 'SOD' && t.type === 'mining') {
                            totalSodMined += t.amount;
                        }
                    });
                }
                
                // Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´
                reportContent.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>ğŸ‘¥ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ú©Ù„</h3>
                            <div class="value">${totalUsers}</div>
                            ${newUsers > 0 ? `<div style="font-size: 12px; color: var(--success);">+${newUsers} Ø¬Ø¯ÛŒØ¯</div>` : ''}
                        </div>
                        <div class="stat-card">
                            <h3>ğŸ’° Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„ÛŒ</h3>
                            <div class="value">${totalRevenue.toFixed(2)} USDT</div>
                        </div>
                        <div class="stat-card">
                            <h3>â›ï¸ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù„</h3>
                            <div class="value">${formatNumber(totalSodMined)} SOD</div>
                        </div>
                        <div class="stat-card">
                            <h3>ğŸ“ˆ Ø±Ø´Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
                            <div class="value">${totalUsers > 0 ? Math.round((newUsers / totalUsers) * 100) : 0}%</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; background: rgba(255,255,255,0.05); padding: 20px; border-radius: var(--radius);">
                        <h3>ğŸ“Š Ø®Ù„Ø§ØµÙ‡ Ú¯Ø²Ø§Ø±Ø´ ${period === 'today' ? 'Ø§Ù…Ø±ÙˆØ²' : 
                                period === 'week' ? 'Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ' : 
                                period === 'month' ? 'Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ' : 'Ù‡Ù…Ù‡ Ø²Ù…Ø§Ù†'}</h3>
                        <div style="margin-top: 15px;">
                            <p>â€¢ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: <strong>${totalUsers}</strong> Ù†ÙØ±</p>
                            <p>â€¢ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯: <strong>${newUsers}</strong> Ù†ÙØ±</p>
                            <p>â€¢ Ø¯Ø±Ø¢Ù…Ø¯ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡: <strong>${totalRevenue.toFixed(4)}</strong> USDT</p>
                            <p>â€¢ SOD Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡: <strong>${formatNumber(totalSodMined)}</strong></p>
                            <p>â€¢ ØªØ§Ø±ÛŒØ® ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´: <strong>${new Date().toLocaleString('fa-IR')}</strong></p>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('âŒ Error generating report:', error);
                reportContent.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--error);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h3>Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // ============ Ù…Ø¯ÛŒØ±ÛŒØª Ú©ÛŒÙ Ù¾ÙˆÙ„ Ùˆ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ ============
        async function loadWalletSettings() {
            try {
                const { data, error } = await supabaseClient
                    .from('wallet_settings')
                    .select('*');
                
                if (error) throw error;
                
                walletSettings = {};
                if (data) {
                    data.forEach(setting => {
                        walletSettings[setting.setting_key] = setting.setting_value;
                    });
                }
                
                renderWalletSettings();
                
            } catch (error) {
                console.error('âŒ Error loading wallet settings:', error);
            }
        }
        
        function renderWalletSettings() {
            // Ø§Ú¯Ø± Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§Ø² Ø§Ø³ØªØŒ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø±Ùˆ Ù¾Ø± Ú©Ù†
            if (document.getElementById('enableBankGateway')) {
                document.getElementById('enableBankGateway').checked = walletSettings.enable_bank_gateway === 'true';
                document.getElementById('bankCardNumber').value = walletSettings.bank_card_number || '';
                document.getElementById('bankAccountHolder').value = walletSettings.bank_account_holder || '';
                document.getElementById('enableCryptoGateway').checked = walletSettings.enable_crypto_gateway === 'true';
                document.getElementById('usdtWalletAddress').value = walletSettings.usdt_wallet_address || '';
                document.getElementById('usdtBep20Address').value = walletSettings.usdt_bep20_address || '';
                
                document.getElementById('minWithdrawalUsdt').value = walletSettings.min_withdrawal_usdt || 10;
                document.getElementById('maxWithdrawalUsdt').value = walletSettings.max_withdrawal_usdt || 1000;
                document.getElementById('withdrawalFeePercent').value = walletSettings.withdrawal_fee_percent || 2;
                document.getElementById('withdrawalProcessingTime').value = walletSettings.withdrawal_processing_time || 24;
                
                document.getElementById('maxDailyBoosts').value = walletSettings.max_daily_boosts || 3;
                document.getElementById('maxDailyPurchases').value = walletSettings.max_daily_purchases || 5;
                document.getElementById('dailyMiningLimit').value = walletSettings.daily_mining_limit || 1000000;
                document.getElementById('walletUsdtCap').value = walletSettings.wallet_usdt_cap || 10000;
            }
        }
        
        function showWalletTab(tabName) {
            // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØªØ¨â€ŒÙ‡Ø§
            document.querySelectorAll('#walletSettingsModal .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('#walletSettingsModal .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªØ¨ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }
        
        function openWalletSettings() {
            loadWalletSettings();
            document.getElementById('walletSettingsModal').classList.add('active');
        }
        
        async function saveWalletSettings() {
            try {
                const settings = {
                    enable_bank_gateway: document.getElementById('enableBankGateway').checked.toString(),
                    bank_card_number: document.getElementById('bankCardNumber').value,
                    bank_account_holder: document.getElementById('bankAccountHolder').value,
                    enable_crypto_gateway: document.getElementById('enableCryptoGateway').checked.toString(),
                    usdt_wallet_address: document.getElementById('usdtWalletAddress').value,
                    usdt_bep20_address: document.getElementById('usdtBep20Address').value,
                    min_withdrawal_usdt: document.getElementById('minWithdrawalUsdt').value,
                    max_withdrawal_usdt: document.getElementById('maxWithdrawalUsdt').value,
                    withdrawal_fee_percent: document.getElementById('withdrawalFeePercent').value,
                    withdrawal_processing_time: document.getElementById('withdrawalProcessingTime').value,
                    max_daily_boosts: document.getElementById('maxDailyBoosts').value,
                    max_daily_purchases: document.getElementById('maxDailyPurchases').value,
                    daily_mining_limit: document.getElementById('dailyMiningLimit').value,
                    wallet_usdt_cap: document.getElementById('walletUsdtCap').value
                };
                
                const updates = [];
                for (const [key, value] of Object.entries(settings)) {
                    updates.push(
                        supabaseClient
                            .from('wallet_settings')
                            .upsert({
                                setting_key: key,
                                setting_value: value,
                                updated_at: new Date().toISOString()
                            })
                    );
                }
                
                await Promise.all(updates);
                showNotification('Ù…ÙˆÙÙ‚', 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                
            } catch (error) {
                console.error('âŒ Error saving wallet settings:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª', 'error');
            }
        }
        
        // ============ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª ============
        async function loadWithdrawalRequests(status = 'pending') {
            try {
                const { data, error } = await supabaseClient
                    .from('withdrawal_requests')
                    .select(`
                        *,
                        users (email, full_name)
                    `)
                    .eq('status', status)
                    .order('created_at', { ascending: false })
                    .limit(50);
                
                if (error) throw error;
                
                withdrawalRequests = data || [];
                renderWithdrawalRequests();
                
            } catch (error) {
                console.error('âŒ Error loading withdrawal requests:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª', 'error');
            }
        }
        
        function renderWithdrawalRequests() {
            const container = document.getElementById('withdrawalRequestsList');
            if (!container) return;
            
            if (withdrawalRequests.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-check-circle" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h3>Ù‡ÛŒÚ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ø¯Ø§Ø´Øª ${getWithdrawalStatusText('pending')} ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</h3>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            withdrawalRequests.forEach(request => {
                const user = request.users;
                const card = document.createElement('div');
                card.className = 'withdrawal-card';
                card.style.cssText = 'background: rgba(255,255,255,0.05); padding: 15px; border-radius: var(--radius); margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1);';
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                        <div>
                            <h4 style="margin: 0 0 5px 0;">${user.full_name || user.email}</h4>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                ${new Date(request.created_at).toLocaleString('fa-IR')}
                            </div>
                        </div>
                        <div style="text-align: left;">
                            <div style="font-size: 18px; font-weight: bold; color: var(--primary);">
                                ${parseFloat(request.amount).toLocaleString()} ${request.currency}
                            </div>
                            <span style="display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 12px; background: ${getWithdrawalStatusColor(request.status)}; color: white; margin-top: 5px;">
                                ${getWithdrawalStatusText(request.status)}
                            </span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="display: flex; margin-bottom: 8px;">
                            <div style="width: 100px; color: var(--text-secondary);">Ø¢Ø¯Ø±Ø³ Ú©ÛŒÙ Ù¾ÙˆÙ„:</div>
                            <div style="flex: 1;">${request.wallet_address}</div>
                        </div>
                        <div style="display: flex; margin-bottom: 8px;">
                            <div style="width: 100px; color: var(--text-secondary);">Ø´Ø¨Ú©Ù‡:</div>
                            <div style="flex: 1;">${request.network}</div>
                        </div>
                        <div style="display: flex;">
                            <div style="width: 100px; color: var(--text-secondary);">Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª:</div>
                            <div style="flex: 1;">${request.id}</div>
                        </div>
                    </div>
                    
                    ${request.admin_notes ? `
                        <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px; margin: 10px 0; font-size: 14px;">
                            <strong>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø§Ø¯Ù…ÛŒÙ†:</strong> ${request.admin_notes}
                        </div>
                    ` : ''}
                    
                    ${request.status === 'pending' ? `
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button class="btn btn-success btn-sm" onclick="processWithdrawal(${request.id}, 'approved')">
                                <i class="fas fa-check"></i> ØªØ£ÛŒÛŒØ¯
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="processWithdrawal(${request.id}, 'rejected')">
                                <i class="fas fa-times"></i> Ø±Ø¯
                            </button>
                            <button class="btn btn-primary btn-sm" onclick="showWithdrawalNotes(${request.id})">
                                <i class="fas fa-edit"></i> ÛŒØ§Ø¯Ø¯Ø§Ø´Øª
                            </button>
                        </div>
                    ` : ''}
                `;
                
                container.appendChild(card);
            });
        }
        
        function getWithdrawalStatusText(status) {
            const statuses = {
                'pending': 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø±Ø³ÛŒ',
                'approved': 'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡',
                'rejected': 'Ø±Ø¯ Ø´Ø¯Ù‡',
                'completed': 'ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡'
            };
            return statuses[status] || status;
        }
        
        function getWithdrawalStatusColor(status) {
            const colors = {
                'pending': 'var(--warning)',
                'approved': 'var(--success)',
                'rejected': 'var(--error)',
                'completed': 'var(--primary)'
            };
            return colors[status] || 'var(--text-secondary)';
        }
        
        async function processWithdrawal(requestId, status) {
            const notes = prompt('Ù„Ø·ÙØ§Ù‹ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):');
            
            try {
                const { error } = await supabaseClient
                    .from('withdrawal_requests')
                    .update({ 
                        status: status,
                        admin_notes: notes || '',
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', requestId);
                
                if (error) throw error;
                
                showNotification('Ù…ÙˆÙÙ‚', `Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ø¯Ø§Ø´Øª ${getWithdrawalStatusText(status)} Ø´Ø¯`);
                await loadWithdrawalRequests('pending');
                
            } catch (error) {
                console.error('âŒ Error processing withdrawal:', error);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øª', 'error');
            }
        }
        
        function showWithdrawalNotes(requestId) {
            const request = withdrawalRequests.find(r => r.id === requestId);
            if (!request) return;
            
            const notes = prompt('ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª:', request.admin_notes || '');
            if (notes !== null) {
                processWithdrawal(requestId, request.status, notes);
            }
        }
        
        function openWithdrawalManagement() {
            loadWithdrawalRequests('pending');
            document.getElementById('withdrawalManagementModal').classList.add('active');
        }
        
        // ============ Ø§ÙØ²ÙˆØ¯Ù† Ù„ÛŒÙ†Ú© Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ù†Ø§ÙˆØ¨Ø±ÛŒ ============
        function addAdminMenuItems() {
            const navMenu = document.querySelector('.nav-menu');
            if (!navMenu) return;
            
            const walletItem = document.createElement('li');
            walletItem.innerHTML = `
                <a href="#" onclick="openWalletSettings()">
                    <i class="fas fa-wallet"></i> Ú©ÛŒÙ Ù¾ÙˆÙ„ Ùˆ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§
                </a>
            `;
            
            const withdrawalsItem = document.createElement('li');
            withdrawalsItem.innerHTML = `
                <a href="#" onclick="openWithdrawalManagement()">
                    <i class="fas fa-money-check-alt"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø±Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§
                </a>
            `;
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù…Ù†Ùˆ (Ù‚Ø¨Ù„ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ")
            navMenu.insertBefore(walletItem, navMenu.children[navMenu.children.length - 2]);
            navMenu.insertBefore(withdrawalsItem, navMenu.children[navMenu.children.length - 2]);
        }
        
        // ============ ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ============
        function formatNumber(num) {
            if (!num && num !== 0) return '0';
            
            if (num >= 1000000000) return (num / 1000000000).toFixed(2) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return Math.floor(num).toLocaleString('fa-IR');
        }
    </script>
        <!-- Ù…ÙˆØ¯Ø§Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ú©ÛŒÙ Ù¾ÙˆÙ„ Ùˆ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ -->
    <div class="modal" id="walletSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-wallet"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©ÛŒÙ Ù¾ÙˆÙ„ Ùˆ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§</h3>
                <button class="modal-close" onclick="closeModal('walletSettingsModal')">Ã—</button>
            </div>
            
            <div class="tabs" style="margin-bottom: 20px;">
                <div class="tab active" onclick="showWalletTab('paymentGateways')">ğŸ’³ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª</div>
                <div class="tab" onclick="showWalletTab('withdrawalSettings')">ğŸ’° ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ø¯Ø§Ø´Øª</div>
                <div class="tab" onclick="showWalletTab('walletLimits')">âš–ï¸ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§</div>
            </div>
            
            <!-- ØªØ¨ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª -->
            <div class="tab-content active" id="paymentGatewaysTab">
                <div class="form-group">
                    <label class="form-label">ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ</label>
                    <input type="checkbox" id="enableBankGateway" checked>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø¨Ø§Ù†Ú©ÛŒ</label>
                    <input type="text" id="bankCardNumber" class="form-input" placeholder="6037-XXXX-XXXX-XXXX">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ù†Ø§Ù… Ø¯Ø§Ø±Ù†Ø¯Ù‡ Ø­Ø³Ø§Ø¨</label>
                    <input type="text" id="bankAccountHolder" class="form-input" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
                </div>
                
                <div class="form-group">
                    <label class="form-label">ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„</label>
                    <input type="checkbox" id="enableCryptoGateway">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø¢Ø¯Ø±Ø³ Ú©ÛŒÙ Ù¾ÙˆÙ„ USDT (TRC20)</label>
                    <input type="text" id="usdtWalletAddress" class="form-input" placeholder="TXXXX...">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø¢Ø¯Ø±Ø³ Ú©ÛŒÙ Ù¾ÙˆÙ„ USDT (BEP20)</label>
                    <input type="text" id="usdtBep20Address" class="form-input" placeholder="0x...">
                </div>
            </div>
            
            <!-- ØªØ¨ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ø¯Ø§Ø´Øª -->
            <div class="tab-content" id="withdrawalSettingsTab">
                <div class="form-group">
                    <label class="form-label">Ø­Ø¯Ø§Ù‚Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª USDT</label>
                    <input type="number" id="minWithdrawalUsdt" class="form-input" value="10" step="0.1">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø­Ø¯Ø§Ú©Ø«Ø± Ø¨Ø±Ø¯Ø§Ø´Øª USDT</label>
                    <input type="number" id="maxWithdrawalUsdt" class="form-input" value="1000" step="0.1">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ú©Ø§Ø±Ù…Ø²Ø¯ Ø¨Ø±Ø¯Ø§Ø´Øª (%)</label>
                    <input type="number" id="withdrawalFeePercent" class="form-input" value="2" step="0.1">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø²Ù…Ø§Ù† Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¨Ø±Ø¯Ø§Ø´Øª (Ø³Ø§Ø¹Øª)</label>
                    <input type="number" id="withdrawalProcessingTime" class="form-input" value="24">
                </div>
            </div>
            
            <!-- ØªØ¨ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ -->
            <div class="tab-content" id="walletLimitsTab">
                <div class="form-group">
                    <label class="form-label">Ø­Ø¯Ø§Ú©Ø«Ø± Ø¨ÙˆØ³Øª Ø±ÙˆØ²Ø§Ù†Ù‡</label>
                    <input type="number" id="maxDailyBoosts" class="form-input" value="3">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø­Ø¯Ø§Ú©Ø«Ø± Ø®Ø±ÛŒØ¯ Ù¾Ù†Ù„ Ø±ÙˆØ²Ø§Ù†Ù‡</label>
                    <input type="number" id="maxDailyPurchases" class="form-input" value="5">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±ÙˆØ²Ø§Ù†Ù‡ (SOD)</label>
                    <input type="number" id="dailyMiningLimit" class="form-input" value="1000000">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø³Ù‚Ù Ú©ÛŒÙ Ù¾ÙˆÙ„ USDT</label>
                    <input type="number" id="walletUsdtCap" class="form-input" value="10000" step="0.1">
                </div>
            </div>
            
            <button class="btn btn-success" onclick="saveWalletSettings()" style="width: 100%; margin-top: 20px;">
                <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            </button>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø±Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ -->
    <div class="modal" id="withdrawalManagementModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3><i class="fas fa-money-check-alt"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª</h3>
                <button class="modal-close" onclick="closeModal('withdrawalManagementModal')">Ã—</button>
            </div>
            
            <div class="tabs" style="margin-bottom: 20px;">
                <div class="tab active" onclick="showWithdrawalTab('pending')">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± (${withdrawalRequests.filter(r => r.status === 'pending').length})</div>
                <div class="tab" onclick="showWithdrawalTab('approved')">âœ… ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</div>
                <div class="tab" onclick="showWithdrawalTab('rejected')">âŒ Ø±Ø¯ Ø´Ø¯Ù‡</div>
            </div>
            
            <div id="withdrawalRequestsList">
                <!-- Ù„ÛŒØ³Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
            </div>
            
            <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                <button class="btn btn-primary" onclick="loadWithdrawalRequests('pending')">
                    <i class="fas fa-sync"></i> Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============ ØªÙˆØ§Ø¨Ø¹ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø±Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ ============
        function showWithdrawalTab(status) {
            // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØªØ¨â€ŒÙ‡Ø§
            document.querySelectorAll('#withdrawalManagementModal .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªØ¨ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            event.target.classList.add('active');
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ ÙˆØ¶Ø¹ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            loadWithdrawalRequests(status);
        }
        
        // ============ Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª ============
        const style = document.createElement('style');
        style.textContent = `
            .withdrawal-card {
                background: rgba(255,255,255,0.05);
                padding: 15px;
                border-radius: var(--radius);
                margin-bottom: 15px;
                border: 1px solid rgba(255,255,255,0.1);
                transition: all 0.3s;
            }
            
            .withdrawal-card:hover {
                background: rgba(255,255,255,0.08);
                border-color: var(--primary);
            }
            
            .withdrawal-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: 10px;
            }
            
            .withdrawal-user h4 {
                margin: 0 0 5px 0;
                color: var(--text);
            }
            
            .withdrawal-amount {
                text-align: left;
            }
            
            .withdrawal-amount .amount {
                font-size: 18px;
                font-weight: bold;
                color: var(--primary);
            }
            
            .withdrawal-details {
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid rgba(255,255,255,0.1);
            }
            
            .detail {
                display: flex;
                margin-bottom: 8px;
                font-size: 14px;
            }
            
            .detail .label {
                width: 120px;
                color: var(--text-secondary);
            }
            
            .detail .value {
                flex: 1;
                word-break: break-all;
            }
            
            .withdrawal-actions {
                display: flex;
                gap: 10px;
                margin-top: 15px;
            }
            
            .badge {
                display: inline-block;
                padding: 3px 8px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 600;
                color: white;
            }
            
            .badge-warning {
                background: var(--warning);
            }
            
            .badge-success {
                background: var(--success);
            }
            
            .badge-danger {
                background: var(--error);
            }
            
            .badge-info {
                background: var(--primary);
            }
        `;
        document.head.appendChild(style);
        
        // ============ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©ÛŒÙ Ù¾ÙˆÙ„ ============
        setTimeout(async () => {
            await loadWalletSettings();
        }, 1000);
        
        // ============ Ø§ÛŒØ¬Ø§Ø¯ ØªØ¨â€ŒÙ‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø±Ø¯Ø§Ø´Øª ============
        function updateWithdrawalTabs() {
            const tabs = document.querySelectorAll('#withdrawalManagementModal .tab');
            if (tabs.length > 0) {
                const pendingCount = withdrawalRequests.filter(r => r.status === 'pending').length;
                tabs[0].innerHTML = `â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± (${pendingCount})`;
            }
        }
        
        // ============ ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ø¯Ø§Ø´Øª ============
        async function updateWithdrawalStatus(requestId, status, notes = '') {
            try {
                const { error } = await supabaseClient
                    .from('withdrawal_requests')
                    .update({ 
                        status: status,
                        admin_notes: notes,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', requestId);
                
                if (error) throw error;
                
                return true;
            } catch (error) {
                console.error('âŒ Error updating withdrawal status:', error);
                return false;
            }
        }
        
        // ============ ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø±Ø¯Ø§Ø´Øª ============
        async function createWithdrawalTransaction(userId, amount, currency, description = 'Ø¨Ø±Ø¯Ø§Ø´Øª') {
            try {
                const { error } = await supabaseClient
                    .from('transactions')
                    .insert({
                        user_id: userId,
                        type: 'withdrawal',
                        amount: -Math.abs(amount), // Ù…Ù‚Ø¯Ø§Ø± Ù…Ù†ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª
                        currency: currency,
                        description: description,
                        status: 'completed'
                    });
                
                if (error) throw error;
                
                return true;
            } catch (error) {
                console.error('âŒ Error creating withdrawal transaction:', error);
                return false;
            }
        }
    </script>
</body>
</html>
