<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´ | SODmAX</title>
    <style>
        :root {
            --primary: #0066ff;
            --secondary: #00d4aa;
            --success: #00c853;
            --warning: #ffb300;
            --danger: #ff3d00;
            --dark: #0a0f1c;
            --card: #121828;
            --text: #ffffff;
            --text-secondary: #94a3b8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--dark);
            color: var(--text);
            min-height: 100vh;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± */
        .sidebar {
            width: 280px;
            background: var(--card);
            border-left: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
            text-decoration: none;
            border-right: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-item:hover {
            background: rgba(255,255,255,0.05);
            color: white;
        }
        
        .nav-item.active {
            background: rgba(0,102,255,0.1);
            color: var(--primary);
            border-right-color: var(--primary);
        }
        
        /* Ù…Ø­ØªÙˆØ§ */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .header {
            background: var(--card);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, var(--card), rgba(18,24,40,0.9));
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .stat-title {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        /* Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§ */
        .table-container {
            background: var(--card);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .table-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: rgba(0,102,255,0.1);
            padding: 15px;
            text-align: right;
            color: var(--primary);
            font-weight: 600;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        tr:hover {
            background: rgba(255,255,255,0.03);
        }
        
        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        /* Badge */
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success { background: rgba(0,200,83,0.2); color: var(--success); }
        .badge-warning { background: rgba(255,179,0,0.2); color: var(--warning); }
        .badge-danger { background: rgba(255,61,0,0.2); color: var(--danger); }
        
        /* ÙØ±Ù…â€ŒÙ‡Ø§ */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* Ù…ÙˆØ¯Ø§Ù„ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: var(--card);
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´</div>
            </div>
            
            <div class="nav-menu">
                <div class="nav-item active" onclick="showPage('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</span>
                </div>
                
                <div class="nav-item" onclick="showPage('products')">
                    <i class="fas fa-box"></i>
                    <span>Ù…Ø­ØµÙˆÙ„Ø§Øª</span>
                </div>
                
                <div class="nav-item" onclick="showPage('orders')">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Ø³ÙØ§Ø±Ø´Ø§Øª</span>
                    <span class="badge badge-warning" id="pendingOrders">0</span>
                </div>
                
                <div class="nav-item" onclick="showPage('payments')">
                    <i class="fas fa-credit-card"></i>
                    <span>Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§</span>
                </div>
                
                <div class="nav-item" onclick="showPage('wallets')">
                    <i class="fas fa-wallet"></i>
                    <span>Ú©ÛŒÙ Ù¾ÙˆÙ„â€ŒÙ‡Ø§</span>
                </div>
                
                <div class="nav-item" onclick="showPage('users')">
                    <i class="fas fa-users"></i>
                    <span>Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</span>
                </div>
                
                <div class="nav-item" onclick="showPage('reports')">
                    <i class="fas fa-chart-bar"></i>
                    <span>Ú¯Ø²Ø§Ø±Ø´Ø§Øª</span>
                </div>
                
                <div class="nav-item" style="margin-top: 20px; color: var(--danger);" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Ø®Ø±ÙˆØ¬</span>
                </div>
            </div>
        </div>
        
        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
        <div class="content">
            <!-- Ù‡Ø¯Ø± -->
            <div class="header">
                <h1 id="pageTitle">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ÙØ±ÙˆØ´</h1>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span id="adminName">Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</span>
                    <button class="btn btn-primary" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i>
                        Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                    </button>
                </div>
            </div>
            
            <!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
            <div id="pageDashboard" class="page">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">ÙØ±ÙˆØ´ Ø§Ù…Ø±ÙˆØ²</div>
                        <div class="stat-value" id="salesToday">0 USDT</div>
                        <div style="color: var(--success); font-size: 14px;">
                            <i class="fas fa-arrow-up"></i> Û±ÛµÙª Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø¯ÛŒØ±ÙˆØ²
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-title">Ø³ÙØ§Ø±Ø´Ø§Øª Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                        <div class="stat-value" id="pendingCount">0</div>
                        <div style="color: var(--warning); font-size: 14px;">
                            Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-title">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯</div>
                        <div class="stat-value" id="newUsers">0</div>
                        <div style="color: var(--secondary); font-size: 14px;">
                            Ø§Ù…Ø±ÙˆØ²
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-title">Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„</div>
                        <div class="stat-value" id="totalRevenue">0 USDT</div>
                        <div style="color: var(--primary); font-size: 14px;">
                            Ø§ÛŒÙ† Ù…Ø§Ù‡
                        </div>
                    </div>
                </div>
                
                <!-- Ø¢Ø®Ø±ÛŒÙ† Ø³ÙØ§Ø±Ø´Ø§Øª -->
                <div class="table-container">
                    <div class="table-header">
                        <h3>Ø¢Ø®Ø±ÛŒÙ† Ø³ÙØ§Ø±Ø´Ø§Øª</h3>
                        <button class="btn btn-primary" onclick="showPage('orders')">
                            Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
                        </button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Ø´Ù…Ø§Ø±Ù‡</th>
                                <th>Ú©Ø§Ø±Ø¨Ø±</th>
                                <th>Ù…Ø­ØµÙˆÙ„</th>
                                <th>Ù…Ø¨Ù„Øº</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="recentOrders">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Ù…Ø­ØµÙˆÙ„Ø§Øª -->
            <div id="pageProducts" class="page" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª</h3>
                        <button class="btn btn-success" onclick="showAddProductModal()">
                            <i class="fas fa-plus"></i> Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯
                        </button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</th>
                                <th>Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡</th>
                                <th>ØªØ®ÙÛŒÙ</th>
                                <th>Ù‚ÛŒÙ…Øª Ù†Ù‡Ø§ÛŒÛŒ</th>
                                <th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Ø³ÙØ§Ø±Ø´Ø§Øª -->
            <div id="pageOrders" class="page" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Ø³ÙØ§Ø±Ø´Ø§Øª</h3>
                        <div style="display: flex; gap: 10px;">
                            <select class="form-input" id="filterStatus" style="width: 150px;">
                                <option value="all">Ù‡Ù…Ù‡ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§</option>
                                <option value="pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</option>
                                <option value="paid">Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡</option>
                                <option value="completed">ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</option>
                                <option value="cancelled">Ù„ØºÙˆ Ø´Ø¯Ù‡</option>
                            </select>
                            <button class="btn btn-primary" onclick="filterOrders()">
                                ÙÛŒÙ„ØªØ±
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´</th>
                                <th>Ú©Ø§Ø±Ø¨Ø±</th>
                                <th>Ù…Ø­ØµÙˆÙ„</th>
                                <th>Ù…Ø¨Ù„Øº</th>
                                <th>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª -->
            <div id="pagePayments" class="page" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª</h3>
                        <button class="btn btn-success" onclick="showAddGatewayModal()">
                            <i class="fas fa-plus"></i> Ø¯Ø±Ú¯Ø§Ù‡ Ø¬Ø¯ÛŒØ¯
                        </button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ù†Ø§Ù… Ø¯Ø±Ú¯Ø§Ù‡</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>Ø­Ø¯Ø§Ù‚Ù„ Ù…Ø¨Ù„Øº</th>
                                <th>Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ø¨Ù„Øº</th>
                                <th>Ú©Ø§Ø±Ù…Ø²Ø¯</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="gatewaysTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Ú©ÛŒÙ Ù¾ÙˆÙ„â€ŒÙ‡Ø§ -->
            <div id="pageWallets" class="page" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Ù…Ø¯ÛŒØ±ÛŒØª Ú©ÛŒÙ Ù¾ÙˆÙ„â€ŒÙ‡Ø§</h3>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-input" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±..." 
                                   id="searchWallet" style="width: 200px;">
                            <button class="btn btn-primary" onclick="searchWallets()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Ú©Ø§Ø±Ø¨Ø±</th>
                                <th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ USDT</th>
                                <th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ SOD</th>
                                <th>Ø¢Ø¯Ø±Ø³ ÙˆÙ„Øª</th>
                                <th>ÙˆØ§Ø±ÛŒØ² Ú©Ù„</th>
                                <th>Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ù„</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="walletsTable">
                            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ -->
    <div class="modal-overlay" id="modalAddProduct">
        <div class="modal">
            <div class="modal-header">
                <h3>Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</h3>
                <button onclick="closeModal('modalAddProduct')" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <div class="form-group">
                        <label class="form-label">Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</label>
                        <input type="text" class="form-input" id="productName" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                        <textarea class="form-input" id="productDescription" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
                        <select class="form-input" id="productCategory" required>
                            <option value="mining">Ø§Ø³ØªØ®Ø±Ø§Ø¬</option>
                            <option value="investment">Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</option>
                            <option value="premium">Ù¾Ø±Ù…ÛŒÙˆÙ…</option>
                            <option value="training">Ø¢Ù…ÙˆØ²Ø´</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ (USDT)</label>
                        <input type="number" class="form-input" id="productBasePrice" min="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø¯Ø±ØµØ¯ ØªØ®ÙÛŒÙ</label>
                        <input type="number" class="form-input" id="productDiscount" min="0" max="100" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ù…Ù‚Ø¯Ø§Ø± SOD Ø¯Ø±ÛŒØ§ÙØªÛŒ</label>
                        <input type="number" class="form-input" id="productSOD" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ù…Ø¯Øª Ø§Ø¹ØªØ¨Ø§Ø± (Ø±ÙˆØ²)</label>
                        <input type="number" class="form-input" id="productDuration" min="1" value="30">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø§Ù…Ú©Ø§Ù†Ø§Øª (Ù‡Ø± Ø®Ø· ÛŒÚ© Ù…ÙˆØ±Ø¯)</label>
                        <textarea class="form-input" id="productFeatures" rows="4" placeholder="Ø§Ù…Ú©Ø§Ù†Ø§Øª Ù…Ø­ØµÙˆÙ„..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø³Ø·Ø­ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²</label>
                        <input type="number" class="form-input" id="productLevel" min="1" value="1">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('modalAddProduct')">Ù„ØºÙˆ</button>
                <button class="btn btn-success" onclick="saveProduct()">Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­ØµÙˆÙ„</button>
            </div>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ú¯Ø§Ù‡ -->
    <div class="modal-overlay" id="modalAddGateway">
        <div class="modal">
            <div class="modal-header">
                <h3>Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª</h3>
                <button onclick="closeModal('modalAddGateway')" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="gatewayForm">
                    <div class="form-group">
                        <label class="form-label">Ù†Ø§Ù… Ø¯Ø±Ú¯Ø§Ù‡</label>
                        <input type="text" class="form-input" id="gatewayName" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ù†ÙˆØ¹ Ø¯Ø±Ú¯Ø§Ù‡</label>
                        <select class="form-input" id="gatewayType" onchange="toggleGatewayFields()" required>
                            <option value="crypto">Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„</option>
                            <option value="bank">Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª</option>
                            <option value="manual">Ø¯Ø³ØªÛŒ</option>
                        </select>
                    </div>
                    
                    <!-- ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„ -->
                    <div id="cryptoFields">
                        <div class="form-group">
                            <label class="form-label">Ø¢Ø¯Ø±Ø³ ÙˆÙ„Øª</label>
                            <input type="text" class="form-input" id="cryptoWallet">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Ø´Ø¨Ú©Ù‡</label>
                            <select class="form-input" id="cryptoNetwork">
                                <option value="TRC20">ØªØ±ÙˆÙ† (TRC20)</option>
                                <option value="ERC20">Ø§ØªØ±ÛŒÙˆÙ… (ERC20)</option>
                                <option value="BEP20">Ø¨ÛŒÙ†Ù†Ø³ (BEP20)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¨Ø§Ù†Ú©ÛŒ -->
                    <div id="bankFields" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª</label>
                            <input type="text" class="form-input" id="bankCard">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Ø´Ù…Ø§Ø±Ù‡ Ø´Ø¨Ø§</label>
                            <input type="text" class="form-input" id="bankSheba">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Ù†Ø§Ù… Ø¯Ø§Ø±Ù†Ø¯Ù‡ Ø­Ø³Ø§Ø¨</label>
                            <input type="text" class="form-input" id="bankOwner">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø­Ø¯Ø§Ù‚Ù„ Ù…Ø¨Ù„Øº (USDT)</label>
                        <input type="number" class="form-input" id="gatewayMin" min="0" step="0.01" value="10">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ø¨Ù„Øº (USDT)</label>
                        <input type="number" class="form-input" id="gatewayMax" min="0" step="0.01" value="10000">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø¯Ø±ØµØ¯ Ú©Ø§Ø±Ù…Ø²Ø¯</label>
                        <input type="number" class="form-input" id="gatewayFee" min="0" max="100" step="0.01" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª</label>
                        <textarea class="form-input" id="gatewayInstructions" rows="4" placeholder="Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('modalAddGateway')">Ù„ØºÙˆ</button>
                <button class="btn btn-success" onclick="saveGateway()">Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±Ú¯Ø§Ù‡</button>
            </div>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©ÛŒÙ Ù¾ÙˆÙ„ -->
    <div class="modal-overlay" id="modalEditWallet">
        <div class="modal">
            <div class="modal-header">
                <h3>ÙˆÛŒØ±Ø§ÛŒØ´ Ú©ÛŒÙ Ù¾ÙˆÙ„</h3>
                <button onclick="closeModal('modalEditWallet')" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="walletForm">
                    <input type="hidden" id="editWalletUserId">
                    
                    <div class="form-group">
                        <label class="form-label">Ø§ÛŒÙ…ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±</label>
                        <input type="email" class="form-input" id="editWalletEmail" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ USDT</label>
                        <input type="number" class="form-input" id="editWalletUSDT" step="0.000001" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ SOD</label>
                        <input type="number" class="form-input" id="editWalletSOD" step="0.01" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø¢Ø¯Ø±Ø³ ÙˆÙ„Øª Ø´Ø®ØµÛŒ</label>
                        <input type="text" class="form-input" id="editWalletAddress">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø´Ø¨Ú©Ù‡</label>
                        <select class="form-input" id="editWalletNetwork">
                            <option value="TRC20">ØªØ±ÙˆÙ† (TRC20)</option>
                            <option value="ERC20">Ø§ØªØ±ÛŒÙˆÙ… (ERC20)</option>
                            <option value="BEP20">Ø¨ÛŒÙ†Ù†Ø³ (BEP20)</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('modalEditWallet')">Ù„ØºÙˆ</button>
                <button class="btn btn-success" onclick="saveWallet()">Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
            </div>
        </div>
    </div>
    
    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ú¯Ù„ÙˆØ¨Ø§Ù„
        const SUPABASE_URL = 'https://wxxhulztrxmjqftxcetp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind4eGh1bHp0cnhtanFmdHhjZXRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNzEwNDcsImV4cCI6MjA4MTY0NzA0N30.iC6Ief8aF-zw66RQRSnLxA-BmAjChQj9xy4HkJpGOA4';
        
        let supabaseClient = null;
        let currentAdmin = null;
        
        // ÙˆÙ‚ØªÛŒ DOM Ù„ÙˆØ¯ Ø´Ø¯
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Sales Admin loaded');
            
            // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Supabase
            supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
            await checkAuth();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
            await loadDashboardData();
            await loadProducts();
            await loadOrders();
            await loadGateways();
            await loadWallets();
        });
        
        // ØªØ§Ø¨Ø¹ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
        async function checkAuth() {
            try {
                const adminData = localStorage.getItem('sales_admin');
                if (adminData) {
                    currentAdmin = JSON.parse(adminData);
                    document.getElementById('adminName').textContent = currentAdmin.name;
                    return true;
                }
                
                // Ú†Ú© Ø§Ø² Supabase
                const { data: { session } } = await supabaseClient.auth.getSession();
                if (session?.user) {
                    const userEmail = session.user.email?.toLowerCase();
                    const adminEmails = ['hamyarhf@gmail.com', 'admin@sodmax.com'];
                    
                    if (adminEmails.includes(userEmail)) {
                        currentAdmin = {
                            id: session.user.id,
                            email: session.user.email,
                            name: session.user.user_metadata?.full_name || 'Ù…Ø¯ÛŒØ± ÙØ±ÙˆØ´'
                        };
                        
                        localStorage.setItem('sales_admin', JSON.stringify(currentAdmin));
                        document.getElementById('adminName').textContent = currentAdmin.name;
                        return true;
                    }
                }
                
                // Ø§Ú¯Ø± Ø§Ø¯Ù…ÛŒÙ† Ù†Ø¨ÙˆØ¯
                window.location.href = 'index.html';
                return false;
                
            } catch (error) {
                console.error('Auth error:', error);
                window.location.href = 'index.html';
            }
        }
        
        // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ø§Øª
        function showPage(pageName) {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØµÙØ­Ø§Øª
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });
            
            // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            document.getElementById('page' + capitalize(pageName)).style.display = 'block';
            
            // Ø¢Ù¾Ø¯ÛŒØª Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡
            const titles = {
                'dashboard': 'Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ÙØ±ÙˆØ´',
                'products': 'Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª',
                'orders': 'Ø³ÙØ§Ø±Ø´Ø§Øª',
                'payments': 'Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª',
                'wallets': 'Ù…Ø¯ÛŒØ±ÛŒØª Ú©ÛŒÙ Ù¾ÙˆÙ„â€ŒÙ‡Ø§',
                'users': 'Ú©Ø§Ø±Ø¨Ø±Ø§Ù†',
                'reports': 'Ú¯Ø²Ø§Ø±Ø´Ø§Øª'
            };
            document.getElementById('pageTitle').textContent = titles[pageName] || 'Ù…Ø¯ÛŒØ±ÛŒØª';
            
            // Ø¢Ù¾Ø¯ÛŒØª Ù…Ù†Ùˆ
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
        }
        
        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        // ============ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ============
        async function loadDashboardData() {
            try {
                // ÙØ±ÙˆØ´ Ø§Ù…Ø±ÙˆØ²
                const today = new Date().toISOString().split('T')[0];
                const { data: todaySales, error: salesError } = await supabaseClient
                    .from('orders')
                    .select('amount')
                    .eq('status', 'completed')
                    .gte('created_at', today + 'T00:00:00Z');
                
                if (!salesError && todaySales) {
                    const total = todaySales.reduce((sum, order) => sum + parseFloat(order.amount), 0);
                    document.getElementById('salesToday').textContent = total.toFixed(2) + ' USDT';
                }
                
                // Ø³ÙØ§Ø±Ø´Ø§Øª Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
                const { data: pendingOrders, error: pendingError } = await supabaseClient
                    .from('orders')
                    .select('count', { count: 'exact' })
                    .eq('status', 'pending');
                
                if (!pendingError) {
                    document.getElementById('pendingCount').textContent = pendingOrders;
                    document.getElementById('pendingOrders').textContent = pendingOrders;
                }
                
                // Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ø§Ù…Ø±ÙˆØ²
                const { data: newUsers, error: usersError } = await supabaseClient
                    .from('users')
                    .select('count', { count: 'exact' })
                    .gte('created_at', today + 'T00:00:00Z');
                
                if (!usersError) {
                    document.getElementById('newUsers').textContent = newUsers;
                }
                
                // Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„ Ø§ÛŒÙ† Ù…Ø§Ù‡
                const firstDay = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
                const { data: monthSales, error: monthError } = await supabaseClient
                    .from('orders')
                    .select('amount')
                    .eq('status', 'completed')
                    .gte('created_at', firstDay + 'T00:00:00Z');
                
                if (!monthError && monthSales) {
                    const totalMonth = monthSales.reduce((sum, order) => sum + parseFloat(order.amount), 0);
                    document.getElementById('totalRevenue').textContent = totalMonth.toFixed(2) + ' USDT';
                }
                
                // Ø¢Ø®Ø±ÛŒÙ† Ø³ÙØ§Ø±Ø´Ø§Øª
                const { data: recentOrders, error: recentError } = await supabaseClient
                    .from('orders')
                    .select(`
                        *,
                        users (email),
                        products (name)
                    `)
                    .order('created_at', { ascending: false })
                    .limit(5);
                
                if (!recentError && recentOrders) {
                    const table = document.getElementById('recentOrders');
                    table.innerHTML = '';
                    
                    recentOrders.forEach((order, index) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${order.id}</td>
                            <td>${order.users?.email || '-'}</td>
                            <td>${order.products?.name || '-'}</td>
                            <td>${order.amount} ${order.currency}</td>
                            <td><span class="badge badge-${getStatusColor(order.status)}">${getStatusText(order.status)}</span></td>
                            <td>${new Date(order.created_at).toLocaleDateString('fa-IR')}</td>
                            <td>
                                <button class="btn" onclick="viewOrder(${order.id})">Ù…Ø´Ø§Ù‡Ø¯Ù‡</button>
                            </td>
                        `;
                        table.appendChild(row);
                    });
                }
                
            } catch (error) {
                console.error('Load dashboard error:', error);
            }
        }
        
        // ============ Ù…Ø­ØµÙˆÙ„Ø§Øª ============
        async function loadProducts() {
            try {
                const { data: products, error } = await supabaseClient
                    .from('products')
                    .select('*')
                    .order('sort_order');
                
                if (error) throw error;
                
                const table = document.getElementById('productsTable');
                table.innerHTML = '';
                
                if (!products || products.length === 0) {
                    table.innerHTML = `
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                products.forEach(product => {
                    const finalPrice = product.base_price * (1 - (product.discount_percent / 100));
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.id}</td>
                        <td><strong>${product.name}</strong></td>
                        <td>${product.base_price} ${product.currency}</td>
                        <td>${product.discount_percent}%</td>
                        <td><strong>${finalPrice.toFixed(2)} ${product.currency}</strong></td>
                        <td>${getCategoryText(product.category)}</td>
                        <td>
                            <span class="badge ${product.is_active ? 'badge-success' : 'badge-danger'}">
                                ${product.is_active ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                            </span>
                        </td>
                        <td>
                            <button class="btn" onclick="editProduct(${product.id})">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            <button class="btn btn-danger" onclick="deleteProduct(${product.id})">Ø­Ø°Ù</button>
                        </td>
                    `;
                    table.appendChild(row);
                });
                
            } catch (error) {
                console.error('Load products error:', error);
            }
        }
        
        function showAddProductModal() {
            document.getElementById('productForm').reset();
            openModal('modalAddProduct');
        }
        
        async function saveProduct() {
            try {
                const productData = {
                    name: document.getElementById('productName').value,
                    description: document.getElementById('productDescription').value,
                    category: document.getElementById('productCategory').value,
                    base_price: parseFloat(document.getElementById('productBasePrice').value),
                    discount_percent: parseFloat(document.getElementById('productDiscount').value) || 0,
                    sod_amount: parseFloat(document.getElementById('productSOD').value),
                    duration_days: parseInt(document.getElementById('productDuration').value),
                    level_required: parseInt(document.getElementById('productLevel').value),
                    is_active: true,
                    features: document.getElementById('productFeatures').value.split('\n').filter(f => f.trim()),
                    created_at: new Date().toISOString()
                };
                
                const { error } = await supabaseClient
                    .from('products')
                    .insert([productData]);
                
                if (error) throw error;
                
                showNotification('Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯', 'success');
                closeModal('modalAddProduct');
                await loadProducts();
                
            } catch (error) {
                console.error('Save product error:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­ØµÙˆÙ„', 'error');
            }
        }
        
        // ============ Ø³ÙØ§Ø±Ø´Ø§Øª ============
        async function loadOrders() {
            try {
                const { data: orders, error } = await supabaseClient
                    .from('orders')
                    .select(`
                        *,
                        users (email),
                        products (name),
                        payment_gateways (name)
                    `)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                renderOrdersTable(orders);
                
            } catch (error) {
                console.error('Load orders error:', error);
            }
        }
        
        function renderOrdersTable(orders) {
            const table = document.getElementById('ordersTable');
            table.innerHTML = '';
            
            if (!orders || orders.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            Ø³ÙØ§Ø±Ø´ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                        </td>
                    </tr>
                `;
                return;
            }
            
            orders.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#${order.id}</td>
                    <td>${order.users?.email || '-'}</td>
                    <td>${order.products?.name || '-'}</td>
                    <td>${order.amount} ${order.currency}</td>
                    <td>${order.payment_gateways?.name || order.payment_method || '-'}</td>
                    <td><span class="badge badge-${getStatusColor(order.status)}">${getStatusText(order.status)}</span></td>
                    <td>${new Date(order.created_at).toLocaleDateString('fa-IR')}</td>
                    <td>
                        <button class="btn" onclick="viewOrder(${order.id})">Ù…Ø´Ø§Ù‡Ø¯Ù‡</button>
                        ${order.status === 'pending' ? `
                            <button class="btn btn-success" onclick="approveOrder(${order.id})">ØªØ£ÛŒÛŒØ¯</button>
                            <button class="btn btn-danger" onclick="rejectOrder(${order.id})">Ø±Ø¯</button>
                        ` : ''}
                    </td>
                `;
                table.appendChild(row);
            });
        }
        
        async function approveOrder(orderId) {
            try {
                const { error } = await supabaseClient
                    .from('orders')
                    .update({ 
                        status: 'completed',
                        admin_notes: 'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ù…Ø¯ÛŒØ±'
                    })
                    .eq('id', orderId);
                
                if (error) throw error;
                
                // Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
                const order = await supabaseClient
                    .from('orders')
                    .select('user_id, amount')
                    .eq('id', orderId)
                    .single();
                
                if (order.data) {
                    await supabaseClient
                        .from('user_wallets')
                        .update({
                            usdt_balance: supabaseClient.rpc('increment', { x: order.data.amount })
                        })
                        .eq('user_id', order.data.user_id);
                }
                
                showNotification('Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØ£ÛŒÛŒØ¯ Ø´Ø¯', 'success');
                await loadOrders();
                await loadDashboardData();
                
            } catch (error) {
                console.error('Approve order error:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± ØªØ£ÛŒÛŒØ¯ Ø³ÙØ§Ø±Ø´', 'error');
            }
        }
        
        // ============ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª ============
        async function loadGateways() {
            try {
                const { data: gateways, error } = await supabaseClient
                    .from('payment_gateways')
                    .select('*')
                    .order('priority');
                
                if (error) throw error;
                
                const table = document.getElementById('gatewaysTable');
                table.innerHTML = '';
                
                gateways.forEach(gateway => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${gateway.id}</td>
                        <td><strong>${gateway.name}</strong></td>
                        <td>${getGatewayTypeText(gateway.type)}</td>
                        <td>${gateway.min_amount} USDT</td>
                        <td>${gateway.max_amount} USDT</td>
                        <td>${gateway.fee_percent}%</td>
                        <td>
                            <span class="badge ${gateway.is_active ? 'badge-success' : 'badge-danger'}">
                                ${gateway.is_active ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                            </span>
                        </td>
                        <td>
                            <button class="btn" onclick="editGateway(${gateway.id})">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                        </td>
                    `;
                    table.appendChild(row);
                });
                
            } catch (error) {
                console.error('Load gateways error:', error);
            }
        }
        
        function showAddGatewayModal() {
            document.getElementById('gatewayForm').reset();
            toggleGatewayFields();
            openModal('modalAddGateway');
        }
        
        function toggleGatewayFields() {
            const type = document.getElementById('gatewayType').value;
            document.getElementById('cryptoFields').style.display = type === 'crypto' ? 'block' : 'none';
            document.getElementById('bankFields').style.display = type === 'bank' ? 'block' : 'none';
        }
        
        async function saveGateway() {
            try {
                const gatewayData = {
                    name: document.getElementById('gatewayName').value,
                    type: document.getElementById('gatewayType').value,
                    min_amount: parseFloat(document.getElementById('gatewayMin').value),
                    max_amount: parseFloat(document.getElementById('gatewayMax').value),
                    fee_percent: parseFloat(document.getElementById('gatewayFee').value),
                    instructions: document.getElementById('gatewayInstructions').value,
                    is_active: true
                };
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®Ø§Øµ
                if (gatewayData.type === 'crypto') {
                    gatewayData.wallet_address = document.getElementById('cryptoWallet').value;
                    gatewayData.network = document.getElementById('cryptoNetwork').value;
                } else if (gatewayData.type === 'bank') {
                    gatewayData.bank_details = {
                        card: document.getElementById('bankCard').value,
                        sheba: document.getElementById('bankSheba').value,
                        owner: document.getElementById('bankOwner').value
                    };
                }
                
                const { error } = await supabaseClient
                    .from('payment_gateways')
                    .insert([gatewayData]);
                
                if (error) throw error;
                
                showNotification('Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯', 'success');
                closeModal('modalAddGateway');
                await loadGateways();
                
            } catch (error) {
                console.error('Save gateway error:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±Ú¯Ø§Ù‡', 'error');
            }
        }
        
        // ============ Ú©ÛŒÙ Ù¾ÙˆÙ„â€ŒÙ‡Ø§ ============
        async function loadWallets() {
            try {
                const { data: wallets, error } = await supabaseClient
                    .from('user_wallets')
                    .select(`
                        *,
                        users (email)
                    `);
                
                if (error) throw error;
                
                renderWalletsTable(wallets);
                
            } catch (error) {
                console.error('Load wallets error:', error);
            }
        }
        
        function renderWalletsTable(wallets) {
            const table = document.getElementById('walletsTable');
            table.innerHTML = '';
            
            if (!wallets || wallets.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            Ú©ÛŒÙ Ù¾ÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                        </td>
                    </tr>
                `;
                return;
            }
            
            wallets.forEach(wallet => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div>${wallet.users?.email || '-'}</div>
                        <small style="color: var(--text-secondary);">${wallet.user_id?.substring(0, 8)}...</small>
                    </td>
                    <td>${parseFloat(wallet.usdt_balance).toFixed(6)}</td>
                    <td>${parseFloat(wallet.sod_balance).toFixed(2)}</td>
                    <td>
                        <div style="font-family: monospace; font-size: 12px;">
                            ${wallet.wallet_address ? wallet.wallet_address.substring(0, 15) + '...' : 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}
                        </div>
                    </td>
                    <td>${parseFloat(wallet.total_deposited).toFixed(6)}</td>
                    <td>${parseFloat(wallet.total_withdrawn).toFixed(6)}</td>
                    <td>
                        <button class="btn" onclick="editWallet('${wallet.user_id}')">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }
        
        async function editWallet(userId) {
            try {
                const { data: wallet, error: walletError } = await supabaseClient
                    .from('user_wallets')
                    .select('*')
                    .eq('user_id', userId)
                    .single();
                
                const { data: user, error: userError } = await supabaseClient
                    .from('users')
                    .select('email')
                    .eq('id', userId)
                    .single();
                
                if (walletError || userError) throw walletError || userError;
                
                document.getElementById('editWalletUserId').value = userId;
                document.getElementById('editWalletEmail').value = user.email;
                document.getElementById('editWalletUSDT').value = wallet.usdt_balance;
                document.getElementById('editWalletSOD').value = wallet.sod_balance;
                document.getElementById('editWalletAddress').value = wallet.wallet_address || '';
                document.getElementById('editWalletNetwork').value = wallet.network || 'TRC20';
                
                openModal('modalEditWallet');
                
            } catch (error) {
                console.error('Edit wallet error:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©ÛŒÙ Ù¾ÙˆÙ„', 'error');
            }
        }
        
        async function saveWallet() {
            try {
                const userId = document.getElementById('editWalletUserId').value;
                const walletData = {
                    usdt_balance: parseFloat(document.getElementById('editWalletUSDT').value),
                    sod_balance: parseFloat(document.getElementById('editWalletSOD').value),
                    wallet_address: document.getElementById('editWalletAddress').value,
                    network: document.getElementById('editWalletNetwork').value
                };
                
                const { error } = await supabaseClient
                    .from('user_wallets')
                    .update(walletData)
                    .eq('user_id', userId);
                
                if (error) throw error;
                
                showNotification('Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯', 'success');
                closeModal('modalEditWallet');
                await loadWallets();
                
            } catch (error) {
                console.error('Save wallet error:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª', 'error');
            }
        }
        
        // ============ ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ============
        function getStatusText(status) {
            const statuses = {
                'pending': 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±',
                'paid': 'Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡',
                'completed': 'ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡',
                'cancelled': 'Ù„ØºÙˆ Ø´Ø¯Ù‡'
            };
            return statuses[status] || status;
        }
        
        function getStatusColor(status) {
            const colors = {
                'pending': 'warning',
                'paid': 'success',
                'completed': 'success',
                'cancelled': 'danger'
            };
            return colors[status] || 'warning';
        }
        
        function getCategoryText(category) {
            const categories = {
                'mining': 'Ø§Ø³ØªØ®Ø±Ø§Ø¬',
                'investment': 'Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ',
                'premium': 'Ù¾Ø±Ù…ÛŒÙˆÙ…',
                'training': 'Ø¢Ù…ÙˆØ²Ø´'
            };
            return categories[category] || category;
        }
        
        function getGatewayTypeText(type) {
            const types = {
                'crypto': 'Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„',
                'bank': 'Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª',
                'manual': 'Ø¯Ø³ØªÛŒ'
            };
            return types[type] || type;
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function showNotification(message, type = 'info') {
            // Ø³Ø§Ø®Øª Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                background: ${type === 'success' ? 'rgba(0,200,83,0.9)' : 
                           type === 'error' ? 'rgba(255,61,0,0.9)' : 
                           'rgba(0,102,255,0.9)'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                z-index: 10000;
                min-width: 300px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                     type === 'error' ? 'exclamation-circle' : 
                                     'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Ø­Ø°Ù Ø¨Ø¹Ø¯ Ø§Ø² 3 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function refreshData() {
            loadDashboardData();
            showNotification('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯', 'success');
        }
        
        function logout() {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
                localStorage.removeItem('sales_admin');
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>
